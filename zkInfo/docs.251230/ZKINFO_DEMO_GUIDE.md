# zkInfo é¡¹ç›®ä½¿ç”¨æ¼”ç¤ºæ–‡æ¡£

## ğŸ“‹ ç›®å½•

1. [ç³»ç»Ÿæ¶æ„](#1-ç³»ç»Ÿæ¶æ„)
2. [å®Œæ•´é“¾è·¯æµç¨‹](#2-å®Œæ•´é“¾è·¯æµç¨‹)
3. [Dubbo Provider å‚æ•°è§£æä¸ MCP Tools ç¼–æ’](#3-dubbo-provider-å‚æ•°è§£æä¸-mcp-tools-ç¼–æ’)
4. [æ“ä½œè„šæœ¬ä¸ç›®æ ‡](#4-æ“ä½œè„šæœ¬ä¸ç›®æ ‡)

---

## 1. ç³»ç»Ÿæ¶æ„

### 1.1 æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        å¤–éƒ¨è°ƒç”¨å±‚                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ MCP Inspectorâ”‚  â”‚ mcp-router-v3â”‚  â”‚  å…¶ä»– MCP å®¢æˆ·ç«¯â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚         â”‚                  â”‚                  â”‚                  â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                            â”‚                                      â”‚
â”‚                            â–¼                                      â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚                    â”‚   zkInfo     â”‚                               â”‚
â”‚                    â”‚  (MCP Server)â”‚                               â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                  â”‚                  â”‚
         â–¼                  â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ZooKeeper   â”‚  â”‚    Nacos     â”‚  â”‚    MySQL     â”‚
â”‚  (æœåŠ¡å‘ç°)   â”‚  â”‚  (æœåŠ¡æ³¨å†Œ)   â”‚  â”‚  (æ•°æ®æŒä¹…åŒ–) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                  â”‚                  â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚  Dubbo Provider  â”‚
                 â”‚   (å®é™…æœåŠ¡æä¾›è€…) â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 æ ¸å¿ƒç»„ä»¶

#### 1.2.1 æ•°æ®æºå±‚
- **ZooKeeper**: å­˜å‚¨ Dubbo æœåŠ¡çš„æ³¨å†Œä¿¡æ¯ï¼ˆProvider èŠ‚ç‚¹ï¼‰
- **MySQL**: æŒä¹…åŒ–é¡¹ç›®ã€æœåŠ¡ã€è™šæ‹Ÿé¡¹ç›®ã€æ–¹æ³•å‚æ•°ç­‰å…ƒæ•°æ®
- **Nacos**: æœåŠ¡æ³¨å†Œä¸­å¿ƒï¼ŒzkInfo å°† MCP æœåŠ¡æ³¨å†Œåˆ° Nacos
- **Redis**: ä¼šè¯ç®¡ç†ï¼ˆSSE è¿æ¥ä¼šè¯ï¼‰

#### 1.2.2 æ ¸å¿ƒæœåŠ¡å±‚

```
ZkInfoApplication (å¯åŠ¨å…¥å£)
    â”‚
    â”œâ”€â”€ ZooKeeperBootstrapService (å¯åŠ¨æ—¶æ‰¹é‡åŠ è½½ ZK æ•°æ®)
    â”‚       â”œâ”€â”€ ä» ZooKeeper æ‹‰å–æ‰€æœ‰ Provider ä¿¡æ¯
    â”‚       â”œâ”€â”€ åº”ç”¨ç™½åå•è¿‡æ»¤
    â”‚       â”œâ”€â”€ æŒä¹…åŒ–åˆ° MySQL
    â”‚       â””â”€â”€ å¯åŠ¨ç›‘å¬
    â”‚
    â”œâ”€â”€ ZooKeeperService (ZooKeeper è¿æ¥ä¸ç›‘å¬)
    â”‚       â”œâ”€â”€ ç›‘å¬ Provider èŠ‚ç‚¹å˜åŒ–
    â”‚       â””â”€â”€ è§¦å‘æœåŠ¡æ³¨å†Œäº‹ä»¶
    â”‚
    â”œâ”€â”€ ServiceCollectionFilterService (ä¸‰å±‚è¿‡æ»¤æœºåˆ¶)
    â”‚       â”œâ”€â”€ é¡¹ç›®çº§è¿‡æ»¤
    â”‚       â”œâ”€â”€ æœåŠ¡çº§è¿‡æ»¤
    â”‚       â””â”€â”€ å®¡æ‰¹çº§è¿‡æ»¤
    â”‚
    â”œâ”€â”€ DubboToMcpAutoRegistrationService (è‡ªåŠ¨æ³¨å†ŒæœåŠ¡)
    â”‚       â”œâ”€â”€ ç›‘å¬ Provider æ·»åŠ /ç§»é™¤äº‹ä»¶
    â”‚       â”œâ”€â”€ åº”ç”¨è¿‡æ»¤è§„åˆ™
    â”‚       â””â”€â”€ è§¦å‘ Nacos æ³¨å†Œ
    â”‚
    â”œâ”€â”€ NacosMcpRegistrationService (Nacos æ³¨å†ŒæœåŠ¡)
    â”‚       â”œâ”€â”€ è§£æ Dubbo Provider ä¿¡æ¯
    â”‚       â”œâ”€â”€ ç”Ÿæˆ MCP Tools
    â”‚       â”œâ”€â”€ æ³¨å†Œåˆ° Nacos é…ç½®ä¸­å¿ƒ
    â”‚       â””â”€â”€ æ³¨å†ŒæœåŠ¡å®ä¾‹
    â”‚
    â”œâ”€â”€ VirtualProjectService (è™šæ‹Ÿé¡¹ç›®ç®¡ç†)
    â”‚       â”œâ”€â”€ åˆ›å»ºè™šæ‹Ÿé¡¹ç›®
    â”‚       â”œâ”€â”€ æœåŠ¡ç¼–æ’ï¼ˆè·¨é¡¹ç›®ç»„åˆï¼‰
    â”‚       â””â”€â”€ æŒä¹…åŒ–åˆ°æ•°æ®åº“
    â”‚
    â””â”€â”€ VirtualProjectRegistrationService (è™šæ‹Ÿé¡¹ç›®æ³¨å†Œ)
            â”œâ”€â”€ èšåˆå¤šä¸ªæœåŠ¡çš„ Provider
            â”œâ”€â”€ ç”Ÿæˆè™šæ‹Ÿé¡¹ç›®çš„ MCP Tools
            â””â”€â”€ æ³¨å†Œåˆ° Nacos
```

#### 1.2.3 å·¥å…·ç”Ÿæˆå±‚

```
McpToolSchemaGenerator (åŸºç¡€å·¥å…·ç”Ÿæˆå™¨)
    â”œâ”€â”€ ä» ZooKeeper å…ƒæ•°æ®è§£ææ–¹æ³•ç­¾å
    â”œâ”€â”€ ä»æ•°æ®åº“æŸ¥è¯¢æ–¹æ³•å‚æ•°ä¿¡æ¯
    â””â”€â”€ ç”ŸæˆåŸºç¡€ inputSchema

EnhancedMcpToolGenerator (å¢å¼ºå·¥å…·ç”Ÿæˆå™¨)
    â”œâ”€â”€ ä½¿ç”¨ Java åå°„è·å–æ–¹æ³•å‚æ•°
    â”œâ”€â”€ é€’å½’è§£æå¤æ‚å¯¹è±¡ç±»å‹
    â”œâ”€â”€ ç”Ÿæˆå®Œæ•´çš„ inputSchemaï¼ˆåŒ…å« formatã€descriptionï¼‰
    â””â”€â”€ ç”Ÿæˆç¬¦åˆ MCP æ ‡å‡†çš„å·¥å…·å®šä¹‰
```

#### 1.2.4 æ¥å£å±‚

```
SseController (SSE è¿æ¥ç®¡ç†)
    â”œâ”€â”€ GET /sse/{endpoint} - å»ºç«‹ SSE è¿æ¥
    â””â”€â”€ å‘é€ endpoint äº‹ä»¶ï¼ˆåŒ…å« message ç«¯ç‚¹ URLï¼‰

McpMessageController (MCP æ¶ˆæ¯å¤„ç†)
    â”œâ”€â”€ POST /mcp/{serviceName}/message - å¤„ç† MCP æ¶ˆæ¯
    â”œâ”€â”€ initialize - åˆå§‹åŒ–å“åº”
    â”œâ”€â”€ tools/list - å·¥å…·åˆ—è¡¨
    â”œâ”€â”€ tools/call - å·¥å…·è°ƒç”¨
    â”œâ”€â”€ resources/list - èµ„æºåˆ—è¡¨
    â””â”€â”€ prompts/list - æç¤ºè¯åˆ—è¡¨

VirtualProjectController (è™šæ‹Ÿé¡¹ç›®ç®¡ç† API)
    â”œâ”€â”€ POST /api/virtual-projects - åˆ›å»ºè™šæ‹Ÿé¡¹ç›®
    â”œâ”€â”€ GET /api/virtual-projects - æŸ¥è¯¢è™šæ‹Ÿé¡¹ç›®åˆ—è¡¨
    â””â”€â”€ DELETE /api/virtual-projects/{id} - åˆ é™¤è™šæ‹Ÿé¡¹ç›®
```

---

## 2. å®Œæ•´é“¾è·¯æµç¨‹

### 2.1 é¡¹ç›®å¯åŠ¨æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. åº”ç”¨å¯åŠ¨ (ZkInfoApplication.main)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Spring Boot åˆå§‹åŒ–                                        â”‚
â”‚    - åŠ è½½é…ç½® (application.yml)                              â”‚
â”‚    - åˆå§‹åŒ–æ•°æ®åº“è¿æ¥ (MySQL)                                â”‚
â”‚    - åˆå§‹åŒ– ZooKeeper è¿æ¥                                   â”‚
â”‚    - åˆå§‹åŒ– Nacos è¿æ¥                                       â”‚
â”‚    - åˆå§‹åŒ– Redis è¿æ¥                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. ApplicationReadyEvent è§¦å‘                                â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚    â”‚ ZooKeeperBootstrapService.bootstrapZooKeeperData() â”‚    â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                            â”‚                                 â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚    â”‚ 3.1 æ‰¹é‡æ‹‰å– ZooKeeper æ•°æ®                  â”‚          â”‚
â”‚    â”‚     - éå† /dubbo/{interface}/providers     â”‚          â”‚
â”‚    â”‚     - è§£æ Provider URL                     â”‚          â”‚
â”‚    â”‚     - åº”ç”¨ç™½åå•è¿‡æ»¤                         â”‚          â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                            â”‚                                 â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚    â”‚ 3.2 æŒä¹…åŒ–åˆ° MySQL                           â”‚          â”‚
â”‚    â”‚     - zk_dubbo_service (æœåŠ¡ä¿¡æ¯)            â”‚          â”‚
â”‚    â”‚     - zk_dubbo_service_node (èŠ‚ç‚¹ä¿¡æ¯)      â”‚          â”‚
â”‚    â”‚     - zk_dubbo_method (æ–¹æ³•ä¿¡æ¯)            â”‚          â”‚
â”‚    â”‚     - zk_dubbo_method_parameter (å‚æ•°ä¿¡æ¯)   â”‚          â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                            â”‚                                 â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚    â”‚ 3.3 å¯åŠ¨ç›‘å¬                                 â”‚          â”‚
â”‚    â”‚     - ZooKeeperService.startWatchingProviders() â”‚      â”‚
â”‚    â”‚     - åªç›‘å¬å·²å®¡æ‰¹çš„æœåŠ¡                     â”‚          â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                            â”‚                                 â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚    â”‚ 3.4 æ·»åŠ å·²å®¡æ‰¹æœåŠ¡åˆ° ProviderService        â”‚          â”‚
â”‚    â”‚     - è§¦å‘è‡ªåŠ¨æ³¨å†Œæµç¨‹                     â”‚          â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. ZkInfoSelfRegistrationService.registerZkInfoNode()        â”‚
â”‚    - æ£€æŸ¥å¹¶æ¸…ç†ä¸å¥åº·çš„è€èŠ‚ç‚¹                                 â”‚
â”‚    - æ³¨å†Œå½“å‰ zkInfo èŠ‚ç‚¹åˆ° Nacos (æœåŠ¡å: zkinfo)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. VirtualProjectService.loadVirtualProjectsFromDatabase()   â”‚
â”‚    - ä»æ•°æ®åº“åŠ è½½è™šæ‹Ÿé¡¹ç›®                                     â”‚
â”‚    - åŠ è½½è™šæ‹Ÿé¡¹ç›® Endpoint                                   â”‚
â”‚    - åŠ è½½é¡¹ç›®æœåŠ¡å…³è”                                        â”‚
â”‚    - æ›´æ–°å†…å­˜ç¼“å­˜                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 ZooKeeper æ•°æ®åŠ è½½ä¸è¿‡æ»¤æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤ 1: è¿æ¥ ZooKeeper                                      â”‚
â”‚   - è¿æ¥å­—ç¬¦ä¸²: zookeeper.connect-string                    â”‚
â”‚   - åŸºç¡€è·¯å¾„: /dubbo                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤ 2: è·å–æ‰€æœ‰æœåŠ¡æ¥å£                                     â”‚
â”‚   - éå† /dubbo ä¸‹çš„æ‰€æœ‰å­èŠ‚ç‚¹                               â”‚
â”‚   - ä¾‹å¦‚: com.pajk.provider2.service.OrderService          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤ 3: ç™½åå•è¿‡æ»¤                                           â”‚
â”‚   - é…ç½®: zk.whitelist.interfaces                           â”‚
â”‚   - è§„åˆ™: å·¦åŒ¹é…ï¼ˆprefix matchï¼‰                             â”‚
â”‚   - ç¤ºä¾‹: com.zkinfo.demo.service â†’ åŒ¹é…                    â”‚
â”‚   - ç¤ºä¾‹: com.other.service â†’ ä¸åŒ¹é…                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤ 4: è·å–æ¯ä¸ªæœåŠ¡çš„ Provider èŠ‚ç‚¹                         â”‚
â”‚   - è·¯å¾„: /dubbo/{interface}/providers                      â”‚
â”‚   - è§£æ Provider URL:                                     â”‚
â”‚     dubbo://192.168.0.101:20880/...?application=...        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤ 5: è§£æ Provider ä¿¡æ¯                                   â”‚
â”‚   - interface: æ¥å£å…¨é™å®šå                                  â”‚
â”‚   - version: ç‰ˆæœ¬å·                                         â”‚
â”‚   - group: åˆ†ç»„                                            â”‚
â”‚   - application: åº”ç”¨å                                    â”‚
â”‚   - address: æœåŠ¡åœ°å€ (IP:Port)                            â”‚
â”‚   - methods: æ–¹æ³•åˆ—è¡¨                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤ 6: æŒä¹…åŒ–åˆ° MySQL                                       â”‚
â”‚   - zk_dubbo_service: æœåŠ¡åŸºæœ¬ä¿¡æ¯                           â”‚
â”‚   - zk_dubbo_service_node: æœåŠ¡èŠ‚ç‚¹ä¿¡æ¯                      â”‚
â”‚   - zk_dubbo_method: æ–¹æ³•ä¿¡æ¯                               â”‚
â”‚   - zk_dubbo_method_parameter: æ–¹æ³•å‚æ•°ä¿¡æ¯                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.3 æœåŠ¡æ³¨å†Œåˆ° Nacos æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è§¦å‘æ¡ä»¶:                                                    â”‚
â”‚   1. ZooKeeper å‘ç°æ–° Provider (ç›‘å¬äº‹ä»¶)                    â”‚
â”‚   2. æœåŠ¡å®¡æ‰¹é€šè¿‡                                            â”‚
â”‚   3. æ‰‹åŠ¨è§¦å‘æ³¨å†Œ                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤ 1: åº”ç”¨ä¸‰å±‚è¿‡æ»¤æœºåˆ¶                                     â”‚
â”‚   ServiceCollectionFilterService.shouldCollect()            â”‚
â”‚   â”œâ”€â”€ é¡¹ç›®çº§è¿‡æ»¤: æ£€æŸ¥æœåŠ¡æ˜¯å¦åœ¨å·²å®šä¹‰çš„é¡¹ç›®ä¸­                â”‚
â”‚   â”œâ”€â”€ æœåŠ¡çº§è¿‡æ»¤: åº”ç”¨è¿‡æ»¤è§„åˆ™ (PROJECT, SERVICE, PATTERN)  â”‚
â”‚   â””â”€â”€ å®¡æ‰¹çº§è¿‡æ»¤: æ£€æŸ¥æœåŠ¡æ˜¯å¦å·²å®¡æ‰¹é€šè¿‡                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼ (é€šè¿‡è¿‡æ»¤)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤ 2: è§£ææ–¹æ³•å‚æ•°ä¿¡æ¯                                      â”‚
â”‚   DubboServiceMethodService.parseMethodParameters()         â”‚
â”‚   â”œâ”€â”€ ä¼˜å…ˆä» ZooKeeper å…ƒæ•°æ®è¯»å–                            â”‚
â”‚   â”‚   /dubbo/metadata/{interface}/provider/{application}   â”‚
â”‚   â”œâ”€â”€ å…¶æ¬¡ä»æ•°æ®åº“æŸ¥è¯¢ (zk_dubbo_method_parameter)         â”‚
â”‚   â””â”€â”€ æœ€åä½¿ç”¨ Java åå°„ (EnhancedMcpToolGenerator)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤ 3: ç”Ÿæˆ MCP Tools                                       â”‚
â”‚   NacosMcpRegistrationService.generateMcpTools()           â”‚
â”‚   â”œâ”€â”€ éå†æ‰€æœ‰æ–¹æ³•                                           â”‚
â”‚   â”œâ”€â”€ ç”Ÿæˆå·¥å…·åç§°: {interface}.{method}                    â”‚
â”‚   â”œâ”€â”€ ç”Ÿæˆå·¥å…·æè¿°                                           â”‚
â”‚   â””â”€â”€ ç”Ÿæˆ inputSchema (ä½¿ç”¨ EnhancedMcpToolGenerator)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤ 4: å‘å¸ƒé…ç½®åˆ° Nacos é…ç½®ä¸­å¿ƒ                            â”‚
â”‚   NacosMcpRegistrationService.publishConfigsToNacos()      â”‚
â”‚   â”œâ”€â”€ Data ID: {mcpServiceName}-tools.json                 â”‚
â”‚   â”œâ”€â”€ Group: mcp-server-tools                               â”‚
â”‚   â””â”€â”€ å†…å®¹: JSON æ ¼å¼çš„ tools åˆ—è¡¨                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤ 5: æ³¨å†ŒæœåŠ¡å®ä¾‹åˆ° Nacos æœåŠ¡åˆ—è¡¨                         â”‚
â”‚   NacosMcpRegistrationService.registerInstanceToNacos()    â”‚
â”‚   â”œâ”€â”€ æœåŠ¡å: zk-mcp-{interface}-{version}                 â”‚
â”‚   â”œâ”€â”€ å®ä¾‹ IP: zkInfo èŠ‚ç‚¹ IP                               â”‚
â”‚   â”œâ”€â”€ å®ä¾‹ Port: zkInfo æœåŠ¡ç«¯å£                            â”‚
â”‚   â”œâ”€â”€ å…ƒæ•°æ®:                                               â”‚
â”‚   â”‚   - sseEndpoint: /sse/{endpoint}                       â”‚
â”‚   â”‚   - sseMessageEndpoint: /mcp/{serviceName}/message      â”‚
â”‚   â”‚   - contextPath: /                                      â”‚
â”‚   â””â”€â”€ ä¸´æ—¶èŠ‚ç‚¹: ephemeral=true (éœ€è¦å¿ƒè·³)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.4 è™šæ‹Ÿé¡¹ç›®åˆ›å»ºä¸æ³¨å†Œæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤ 1: åˆ›å»ºè™šæ‹Ÿé¡¹ç›® (API è°ƒç”¨)                               â”‚
â”‚   POST /api/virtual-projects                                 â”‚
â”‚   {                                                          â”‚
â”‚     "name": "æ•°æ®åˆ†æå¹³å°",                                   â”‚
â”‚     "code": "data-analysis",                                 â”‚
â”‚     "endpointName": "data-analysis-endpoint",                â”‚
â”‚     "serviceIds": [1, 2, 3]  // å®é™…é¡¹ç›®çš„æœåŠ¡ ID            â”‚
â”‚   }                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤ 2: VirtualProjectService.createVirtualProject()        â”‚
â”‚   â”œâ”€â”€ åˆ›å»º Project å®ä½“ (type=VIRTUAL)                      â”‚
â”‚   â”œâ”€â”€ åˆ›å»º VirtualProjectEndpoint å®ä½“                      â”‚
â”‚   â”œâ”€â”€ åˆ›å»º ProjectService å…³è”                              â”‚
â”‚   â””â”€â”€ æŒä¹…åŒ–åˆ°æ•°æ®åº“                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤ 3: VirtualProjectRegistrationService                   â”‚
â”‚         .registerVirtualProjectToNacos()                    â”‚
â”‚   â”œâ”€â”€ èšåˆæ‰€æœ‰æœåŠ¡çš„ Provider                                â”‚
â”‚   â”œâ”€â”€ å»é‡ï¼ˆç›¸åŒæ¥å£ã€ç‰ˆæœ¬ã€åˆ†ç»„ï¼‰                           â”‚
â”‚   â””â”€â”€ è°ƒç”¨ NacosMcpRegistrationService                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤ 4: NacosMcpRegistrationService                         â”‚
â”‚         .registerVirtualProjectAsMcp()                      â”‚
â”‚   â”œâ”€â”€ ç”Ÿæˆ MCP æœåŠ¡å: virtual-{endpointName}               â”‚
â”‚   â”œâ”€â”€ ç”Ÿæˆå·¥å…·åˆ—è¡¨ï¼ˆèšåˆæ‰€æœ‰æœåŠ¡çš„å·¥å…·ï¼‰                      â”‚
â”‚   â”œâ”€â”€ å‘å¸ƒé…ç½®åˆ° Nacos                                       â”‚
â”‚   â””â”€â”€ æ³¨å†Œæ‰€æœ‰æ´»è·ƒçš„ zkInfo èŠ‚ç‚¹                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.5 å¤–éƒ¨è°ƒç”¨é“¾è·¯

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å®¢æˆ·ç«¯ (MCP Inspector / mcp-router-v3)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. å»ºç«‹ SSE è¿æ¥                                             â”‚
â”‚   GET /sse/virtual-data-analysis-endpoint                    â”‚
â”‚   Response:                                                 â”‚
â”‚   event: endpoint                                           â”‚
â”‚   data: http://192.168.0.101:9091/mcp/virtual-data-analysis-â”‚
â”‚         endpoint/message?sessionId=xxx                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. å‘é€ initialize è¯·æ±‚                                      â”‚
â”‚   POST /mcp/virtual-data-analysis-endpoint/message?sessionId=xxx â”‚
â”‚   {                                                          â”‚
â”‚     "method": "initialize",                                 â”‚
â”‚     "params": {...},                                         â”‚
â”‚     "id": 0                                                  â”‚
â”‚   }                                                          â”‚
â”‚   Response (via SSE):                                       â”‚
â”‚   {                                                          â”‚
â”‚     "jsonrpc": "2.0",                                       â”‚
â”‚     "id": "0",                                              â”‚
â”‚     "result": {                                             â”‚
â”‚       "protocolVersion": "2024-11-05",                      â”‚
â”‚       "capabilities": {                                     â”‚
â”‚         "tools": {"listChanged": true},                     â”‚
â”‚         "resources": {"listChanged": true},                 â”‚
â”‚         "prompts": {"listChanged": true}                    â”‚
â”‚       }                                                      â”‚
â”‚     }                                                        â”‚
â”‚   }                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. å®¢æˆ·ç«¯è‡ªåŠ¨è°ƒç”¨ tools/list (æ ¹æ® listChanged=true)         â”‚
â”‚   POST /mcp/virtual-data-analysis-endpoint/message?sessionId=xxx â”‚
â”‚   {                                                          â”‚
â”‚     "method": "tools/list",                                 â”‚
â”‚     "params": {},                                           â”‚
â”‚     "id": 1                                                  â”‚
â”‚   }                                                          â”‚
â”‚   Response (via SSE):                                       â”‚
â”‚   {                                                          â”‚
â”‚     "jsonrpc": "2.0",                                       â”‚
â”‚     "id": "1",                                              â”‚
â”‚     "result": {                                             â”‚
â”‚       "tools": [                                            â”‚
â”‚         {                                                    â”‚
â”‚           "name": "com.pajk.service.OrderService.getOrder", â”‚
â”‚           "description": "...",                             â”‚
â”‚           "inputSchema": {...}                              â”‚
â”‚         }                                                    â”‚
â”‚       ]                                                      â”‚
â”‚     }                                                        â”‚
â”‚   }                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. è°ƒç”¨å·¥å…· (tools/call)                                     â”‚
â”‚   POST /mcp/virtual-data-analysis-endpoint/message?sessionId=xxx â”‚
â”‚   {                                                          â”‚
â”‚     "method": "tools/call",                                â”‚
â”‚     "params": {                                             â”‚
â”‚       "name": "com.pajk.service.OrderService.getOrder",     â”‚
â”‚       "arguments": {                                        â”‚
â”‚         "orderId": "12345",                                 â”‚
â”‚         "status": "ACTIVE"                                  â”‚
â”‚       }                                                      â”‚
â”‚     },                                                       â”‚
â”‚     "id": 2                                                  â”‚
â”‚   }                                                          â”‚
â”‚   Response (via SSE):                                       â”‚
â”‚   {                                                          â”‚
â”‚     "jsonrpc": "2.0",                                       â”‚
â”‚     "id": "2",                                              â”‚
â”‚     "result": {                                             â”‚
â”‚       "content": [                                          â”‚
â”‚         {                                                    â”‚
â”‚           "type": "text",                                   â”‚
â”‚           "text": "{\"orderId\":\"12345\",...}"            â”‚
â”‚         }                                                    â”‚
â”‚       ]                                                      â”‚
â”‚     }                                                        â”‚
â”‚   }                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. Dubbo Provider å‚æ•°è§£æä¸ MCP Tools ç¼–æ’

### 3.1 å‚æ•°è§£ææµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ•°æ®æºä¼˜å…ˆçº§:                                                â”‚
â”‚   1. ZooKeeper å…ƒæ•°æ® (æœ€é«˜ä¼˜å…ˆçº§)                          â”‚
â”‚   2. MySQL æ•°æ®åº“ (zk_dubbo_method_parameter)              â”‚
â”‚   3. Java åå°„ (EnhancedMcpToolGenerator)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤ 1: ä» ZooKeeper å…ƒæ•°æ®è§£æ                              â”‚
â”‚   DubboServiceMethodService.parseMethodParametersFromMetadata() â”‚
â”‚   â”œâ”€â”€ è·¯å¾„: /dubbo/metadata/{interface}/provider/{app}     â”‚
â”‚   â”œâ”€â”€ è¯»å– methods æ•°ç»„                                     â”‚
â”‚   â”œâ”€â”€ åŒ¹é…æ–¹æ³•å                                            â”‚
â”‚   â”œâ”€â”€ è§£æ parameterTypes                                   â”‚
â”‚   â””â”€â”€ è§£æ parameterNames (å¦‚æœå¯ç”¨)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼ (å¦‚æœå¤±è´¥)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤ 2: ä»æ•°æ®åº“æŸ¥è¯¢                                         â”‚
â”‚   DubboMethodParameterMapper.findByMethodId()               â”‚
â”‚   â”œâ”€â”€ æŸ¥è¯¢ zk_dubbo_method_parameter è¡¨                      â”‚
â”‚   â”œâ”€â”€ è·å– parameter_name, parameter_type, parameter_order â”‚
â”‚   â””â”€â”€ è·å– parameter_description                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼ (å¦‚æœå¤±è´¥)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤ 3: ä½¿ç”¨ Java åå°„                                       â”‚
â”‚   EnhancedMcpToolGenerator.getParametersFromReflection()    â”‚
â”‚   â”œâ”€â”€ åŠ è½½æ¥å£ç±»                                            â”‚
â”‚   â”œâ”€â”€ è·å–æ–¹æ³•å¯¹è±¡                                          â”‚
â”‚   â”œâ”€â”€ è·å–å‚æ•°å (å¦‚æœç¼–è¯‘æ—¶ä½¿ç”¨ -parameters)               â”‚
â”‚   â”œâ”€â”€ è·å–å‚æ•°ç±»å‹                                          â”‚
â”‚   â””â”€â”€ è·å–å‚æ•°é¡ºåº                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤ 4: é€’å½’è§£æå¤æ‚å¯¹è±¡ç±»å‹                                 â”‚
â”‚   EnhancedMcpToolGenerator.getClassFieldsFromReflection()   â”‚
â”‚   â”œâ”€â”€ è·å–ç±»çš„æ‰€æœ‰å­—æ®µ                                       â”‚
â”‚   â”œâ”€â”€ è·å–å­—æ®µç±»å‹                                          â”‚
â”‚   â”œâ”€â”€ å¦‚æœæ˜¯å¤æ‚å¯¹è±¡ï¼Œé€’å½’è§£æ                               â”‚
â”‚   â””â”€â”€ ç”ŸæˆåµŒå¥—çš„ properties                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤ 5: ç”Ÿæˆ inputSchema                                    â”‚
â”‚   EnhancedMcpToolGenerator.createEnhancedParameterProperty() â”‚
â”‚   â”œâ”€â”€ type: åŸºç¡€ç±»å‹ (string, integer, object, array)      â”‚
â”‚   â”œâ”€â”€ format: æ ¼å¼ (int64, int32, date-time)               â”‚
â”‚   â”œâ”€â”€ description: å‚æ•°æè¿°                                 â”‚
â”‚   â”œâ”€â”€ examples: ç¤ºä¾‹å€¼ (å¦‚æœæœ‰)                             â”‚
â”‚   â””â”€â”€ additionalProperties: false                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 MCP Tool ç”Ÿæˆç¤ºä¾‹

#### 3.2.1 ç®€å•å‚æ•°ç¤ºä¾‹

**Dubbo æ–¹æ³•**:
```java
public Order getOrderById(String orderId, String status);
```

**ç”Ÿæˆçš„ MCP Tool**:
```json
{
  "name": "com.pajk.provider2.service.OrderService.getOrderById",
  "description": "Get order by ID and status. Returns Order object with order details.",
  "inputSchema": {
    "type": "object",
    "properties": {
      "orderId": {
        "type": "string",
        "description": "Order's unique identifier",
        "examples": []
      },
      "status": {
        "type": "string",
        "description": "Order status (e.g., ACTIVE, CANCELLED)",
        "examples": []
      }
    },
    "required": ["orderId", "status"],
    "additionalProperties": false
  }
}
```

#### 3.2.2 å¤æ‚å¯¹è±¡å‚æ•°ç¤ºä¾‹

**Dubbo æ–¹æ³•**:
```java
public void createOrder(OrderRequest request);
```

**OrderRequest ç±»**:
```java
public class OrderRequest {
    private String userId;
    private List<OrderItem> items;
    private Address shippingAddress;
}
```

**ç”Ÿæˆçš„ MCP Tool**:
```json
{
  "name": "com.pajk.provider2.service.OrderService.createOrder",
  "description": "Create a new order. Returns void.",
  "inputSchema": {
    "type": "object",
    "properties": {
      "request": {
        "type": "object",
        "description": "Order creation request",
        "properties": {
          "userId": {
            "type": "string",
            "description": "User's ID who places the order"
          },
          "items": {
            "type": "array",
            "description": "List of order items",
            "items": {
              "type": "object",
              "properties": {
                "productId": {"type": "string"},
                "quantity": {"type": "integer", "format": "int32"}
              }
            }
          },
          "shippingAddress": {
            "type": "object",
            "properties": {
              "street": {"type": "string"},
              "city": {"type": "string"},
              "zipCode": {"type": "string"}
            }
          }
        },
        "required": ["userId", "items"],
        "additionalProperties": false
      }
    },
    "required": ["request"],
    "additionalProperties": false
  }
}
```

### 3.3 å·¥å…·ç¼–æ’æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è™šæ‹Ÿé¡¹ç›®å·¥å…·ç¼–æ’                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤ 1: èšåˆæ‰€æœ‰æœåŠ¡çš„ Provider                              â”‚
â”‚   VirtualProjectRegistrationService.aggregateProviders()    â”‚
â”‚   â”œâ”€â”€ æŸ¥è¯¢æ‰€æœ‰å…³è”çš„ ProjectService                         â”‚
â”‚   â”œâ”€â”€ è·å–æ¯ä¸ªæœåŠ¡çš„æ‰€æœ‰ Provider                           â”‚
â”‚   â””â”€â”€ å»é‡ï¼ˆç›¸åŒæ¥å£ã€ç‰ˆæœ¬ã€åˆ†ç»„ï¼‰                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤ 2: ç”Ÿæˆå·¥å…·åˆ—è¡¨                                          â”‚
â”‚   NacosMcpRegistrationService.generateMcpTools()            â”‚
â”‚   â”œâ”€â”€ éå†æ‰€æœ‰ Provider                                     â”‚
â”‚   â”œâ”€â”€ éå†æ¯ä¸ª Provider çš„æ–¹æ³•                              â”‚
â”‚   â”œâ”€â”€ è§£ææ–¹æ³•å‚æ•°                                           â”‚
â”‚   â””â”€â”€ ç”Ÿæˆå·¥å…·å®šä¹‰                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤ 3: å‘å¸ƒåˆ° Nacos é…ç½®ä¸­å¿ƒ                                 â”‚
â”‚   Data ID: virtual-{endpointName}-tools.json                â”‚
â”‚   Group: mcp-server-tools                                    â”‚
â”‚   å†…å®¹: æ‰€æœ‰å·¥å…·çš„ JSON æ•°ç»„                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. æ“ä½œè„šæœ¬ä¸ç›®æ ‡

### 4.1 ç¯å¢ƒå‡†å¤‡

#### 4.1.1 å‰ç½®æ¡ä»¶æ£€æŸ¥è„šæœ¬

åˆ›å»ºæ–‡ä»¶: `scripts/check-prerequisites.sh`

```bash
#!/bin/bash

echo "=========================================="
echo "zkInfo å‰ç½®æ¡ä»¶æ£€æŸ¥"
echo "=========================================="

# æ£€æŸ¥ Java ç‰ˆæœ¬
echo "1. æ£€æŸ¥ Java ç‰ˆæœ¬..."
java -version 2>&1 | grep -q "1.8\|11\|17" && echo "âœ… Java ç‰ˆæœ¬æ­£ç¡®" || echo "âŒ Java ç‰ˆæœ¬ä¸æ­£ç¡®"

# æ£€æŸ¥ MySQL è¿æ¥
echo "2. æ£€æŸ¥ MySQL è¿æ¥..."
mysql -h${MYSQL_HOST:-127.0.0.1} -u${MYSQL_USERNAME:-mcp_user} -p${MYSQL_PASSWORD:-mcp_user} -e "SELECT 1" > /dev/null 2>&1
[ $? -eq 0 ] && echo "âœ… MySQL è¿æ¥æ­£å¸¸" || echo "âŒ MySQL è¿æ¥å¤±è´¥"

# æ£€æŸ¥ ZooKeeper è¿æ¥
echo "3. æ£€æŸ¥ ZooKeeper è¿æ¥..."
echo "stat" | nc ${ZK_CONNECT_STRING:-127.0.0.1:2181} > /dev/null 2>&1
[ $? -eq 0 ] && echo "âœ… ZooKeeper è¿æ¥æ­£å¸¸" || echo "âŒ ZooKeeper è¿æ¥å¤±è´¥"

# æ£€æŸ¥ Nacos è¿æ¥
echo "4. æ£€æŸ¥ Nacos è¿æ¥..."
curl -s http://${NACOS_SERVER_ADDR:-127.0.0.1:8848}/nacos/v1/console/health > /dev/null 2>&1
[ $? -eq 0 ] && echo "âœ… Nacos è¿æ¥æ­£å¸¸" || echo "âŒ Nacos è¿æ¥å¤±è´¥"

# æ£€æŸ¥ Redis è¿æ¥
echo "5. æ£€æŸ¥ Redis è¿æ¥..."
redis-cli -h ${REDIS_HOST:-127.0.0.1} -p ${REDIS_PORT:-6379} ping > /dev/null 2>&1
[ $? -eq 0 ] && echo "âœ… Redis è¿æ¥æ­£å¸¸" || echo "âŒ Redis è¿æ¥å¤±è´¥"

echo "=========================================="
```

#### 4.1.2 æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬

åˆ›å»ºæ–‡ä»¶: `scripts/init-database.sh`

```bash
#!/bin/bash

echo "=========================================="
echo "åˆå§‹åŒ– zkInfo æ•°æ®åº“"
echo "=========================================="

MYSQL_HOST=${MYSQL_HOST:-127.0.0.1}
MYSQL_PORT=${MYSQL_PORT:-3306}
MYSQL_USERNAME=${MYSQL_USERNAME:-mcp_user}
MYSQL_PASSWORD=${MYSQL_PASSWORD:-mcp_user}
MYSQL_DATABASE=${MYSQL_DATABASE:-mcp_bridge}

# æ‰§è¡Œ SQL è„šæœ¬
echo "æ‰§è¡Œæ•°æ®åº“åˆå§‹åŒ–è„šæœ¬..."
mysql -h${MYSQL_HOST} -P${MYSQL_PORT} -u${MYSQL_USERNAME} -p${MYSQL_PASSWORD} ${MYSQL_DATABASE} < src/main/resources/db/schema.sql

[ $? -eq 0 ] && echo "âœ… æ•°æ®åº“åˆå§‹åŒ–æˆåŠŸ" || echo "âŒ æ•°æ®åº“åˆå§‹åŒ–å¤±è´¥"

echo "=========================================="
```

### 4.2 å¯åŠ¨æµç¨‹è„šæœ¬

#### 4.2.1 å¯åŠ¨ zkInfo æœåŠ¡

åˆ›å»ºæ–‡ä»¶: `scripts/start-zkinfo.sh`

```bash
#!/bin/bash

echo "=========================================="
echo "å¯åŠ¨ zkInfo æœåŠ¡"
echo "=========================================="

# è®¾ç½®ç¯å¢ƒå˜é‡
export MYSQL_HOST=${MYSQL_HOST:-127.0.0.1}
export MYSQL_PORT=${MYSQL_PORT:-3306}
export MYSQL_USERNAME=${MYSQL_USERNAME:-mcp_user}
export MYSQL_PASSWORD=${MYSQL_PASSWORD:-mcp_user}
export MYSQL_DATABASE=${MYSQL_DATABASE:-mcp_bridge}

export ZK_CONNECT_STRING=${ZK_CONNECT_STRING:-127.0.0.1:2181}
export NACOS_SERVER_ADDR=${NACOS_SERVER_ADDR:-127.0.0.1:8848}
export NACOS_USERNAME=${NACOS_USERNAME:-nacos}
export NACOS_PASSWORD=${NACOS_PASSWORD:-nacos}

export REDIS_HOST=${REDIS_HOST:-127.0.0.1}
export REDIS_PORT=${REDIS_PORT:-6379}

# å¯åŠ¨æœåŠ¡
cd /Users/shine/projects.mcp-router-sse-parent/zk-mcp-parent/zkInfo
mvn spring-boot:run

echo "=========================================="
```

### 4.3 éªŒè¯æµç¨‹è„šæœ¬

#### 4.3.1 éªŒè¯æœåŠ¡æ³¨å†Œ

åˆ›å»ºæ–‡ä»¶: `scripts/verify-service-registration.sh`

```bash
#!/bin/bash

echo "=========================================="
echo "éªŒè¯æœåŠ¡æ³¨å†ŒçŠ¶æ€"
echo "=========================================="

NACOS_SERVER=${NACOS_SERVER_ADDR:-127.0.0.1:8848}
NACOS_USERNAME=${NACOS_USERNAME:-nacos}
NACOS_PASSWORD=${NACOS_PASSWORD:-nacos}

# 1. æ£€æŸ¥ zkInfo èŠ‚ç‚¹æ³¨å†Œ
echo "1. æ£€æŸ¥ zkInfo èŠ‚ç‚¹æ³¨å†Œ..."
curl -s -u ${NACOS_USERNAME}:${NACOS_PASSWORD} \
  "http://${NACOS_SERVER}/nacos/v1/ns/instance/list?serviceName=zkinfo&namespaceId=public" | jq '.hosts[] | {ip, port, healthy, enabled}'

# 2. æ£€æŸ¥ MCP æœåŠ¡æ³¨å†Œ
echo "2. æ£€æŸ¥ MCP æœåŠ¡æ³¨å†Œ..."
curl -s -u ${NACOS_USERNAME}:${NACOS_PASSWORD} \
  "http://${NACOS_SERVER}/nacos/v1/ns/service/list?pageNo=1&pageSize=100&namespaceId=public" | \
  jq '.doms[] | select(. | startswith("zk-mcp-") or startswith("virtual-"))'

# 3. æ£€æŸ¥å·¥å…·é…ç½®
echo "3. æ£€æŸ¥å·¥å…·é…ç½®..."
SERVICE_NAME="zk-mcp-com.pajk.provider2.service.OrderService-1.0.0"
curl -s -u ${NACOS_USERNAME}:${NACOS_PASSWORD} \
  "http://${NACOS_SERVER}/nacos/v1/cs/configs?dataId=${SERVICE_NAME}-tools.json&group=mcp-server-tools&namespaceId=public" | jq '.tools | length'

echo "=========================================="
```

#### 4.3.2 éªŒè¯è™šæ‹Ÿé¡¹ç›®

åˆ›å»ºæ–‡ä»¶: `scripts/verify-virtual-project.sh`

```bash
#!/bin/bash

ENDPOINT_NAME=${1:-test-virtual-endpoint001}

echo "=========================================="
echo "éªŒè¯è™šæ‹Ÿé¡¹ç›®: ${ENDPOINT_NAME}"
echo "=========================================="

ZKINFO_URL=${ZKINFO_URL:-http://192.168.0.101:9091}

# 1. æŸ¥è¯¢è™šæ‹Ÿé¡¹ç›®
echo "1. æŸ¥è¯¢è™šæ‹Ÿé¡¹ç›®..."
curl -s "${ZKINFO_URL}/api/virtual-projects?endpointName=${ENDPOINT_NAME}" | jq '.'

# 2. æŸ¥è¯¢è™šæ‹Ÿé¡¹ç›®å·¥å…·
echo "2. æŸ¥è¯¢è™šæ‹Ÿé¡¹ç›®å·¥å…·..."
curl -s "${ZKINFO_URL}/api/virtual-projects/${ENDPOINT_NAME}/tools" | jq '.tools | length'

# 3. æµ‹è¯• SSE è¿æ¥
echo "3. æµ‹è¯• SSE è¿æ¥..."
SESSION_ID=$(uuidgen)
curl -N -H "Accept: text/event-stream" \
  "${ZKINFO_URL}/sse/virtual-${ENDPOINT_NAME}" \
  -o /tmp/sse-response.txt &
SSE_PID=$!

sleep 2
kill $SSE_PID 2>/dev/null

if [ -f /tmp/sse-response.txt ]; then
    echo "SSE å“åº”å†…å®¹:"
    cat /tmp/sse-response.txt
    rm /tmp/sse-response.txt
fi

echo "=========================================="
```

### 4.4 å®Œæ•´æ¼”ç¤ºæµç¨‹è„šæœ¬

#### 4.4.1 ç«¯åˆ°ç«¯æ¼”ç¤ºè„šæœ¬

åˆ›å»ºæ–‡ä»¶: `scripts/demo-complete-flow.sh`

```bash
#!/bin/bash

echo "=========================================="
echo "zkInfo å®Œæ•´æµç¨‹æ¼”ç¤º"
echo "=========================================="

ZKINFO_URL=${ZKINFO_URL:-http://192.168.0.101:9091}
NACOS_SERVER=${NACOS_SERVER_ADDR:-127.0.0.1:8848}
NACOS_USERNAME=${NACOS_USERNAME:-nacos}
NACOS_PASSWORD=${NACOS_PASSWORD:-nacos}

# æ­¥éª¤ 1: æ£€æŸ¥æœåŠ¡çŠ¶æ€
echo "æ­¥éª¤ 1: æ£€æŸ¥ zkInfo æœåŠ¡çŠ¶æ€..."
curl -s "${ZKINFO_URL}/actuator/health" | jq '.'

# æ­¥éª¤ 2: æŸ¥è¯¢å·²æ³¨å†Œçš„æœåŠ¡
echo ""
echo "æ­¥éª¤ 2: æŸ¥è¯¢å·²æ³¨å†Œçš„ Dubbo æœåŠ¡..."
curl -s "${ZKINFO_URL}/api/dubbo-services?page=1&size=10" | jq '.data[] | {id, interfaceName, version, status}'

# æ­¥éª¤ 3: åˆ›å»ºè™šæ‹Ÿé¡¹ç›®
echo ""
echo "æ­¥éª¤ 3: åˆ›å»ºè™šæ‹Ÿé¡¹ç›®..."
VIRTUAL_PROJECT_RESPONSE=$(curl -s -X POST "${ZKINFO_URL}/api/virtual-projects" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "æ¼”ç¤ºè™šæ‹Ÿé¡¹ç›®",
    "code": "demo-virtual-project",
    "endpointName": "demo-endpoint",
    "serviceIds": [1, 2]
  }')

echo "$VIRTUAL_PROJECT_RESPONSE" | jq '.'

ENDPOINT_NAME=$(echo "$VIRTUAL_PROJECT_RESPONSE" | jq -r '.data.endpoint.endpointName')

# æ­¥éª¤ 4: ç­‰å¾…æ³¨å†Œå®Œæˆ
echo ""
echo "æ­¥éª¤ 4: ç­‰å¾…è™šæ‹Ÿé¡¹ç›®æ³¨å†Œåˆ° Nacos..."
sleep 5

# æ­¥éª¤ 5: éªŒè¯ Nacos æ³¨å†Œ
echo ""
echo "æ­¥éª¤ 5: éªŒè¯ Nacos æ³¨å†Œ..."
curl -s -u ${NACOS_USERNAME}:${NACOS_PASSWORD} \
  "http://${NACOS_SERVER}/nacos/v1/ns/instance/list?serviceName=virtual-${ENDPOINT_NAME}&namespaceId=public" | \
  jq '.hosts[] | {ip, port, healthy}'

# æ­¥éª¤ 6: æŸ¥è¯¢å·¥å…·åˆ—è¡¨
echo ""
echo "æ­¥éª¤ 6: æŸ¥è¯¢è™šæ‹Ÿé¡¹ç›®å·¥å…·åˆ—è¡¨..."
curl -s "${ZKINFO_URL}/api/virtual-projects/${ENDPOINT_NAME}/tools" | \
  jq '.tools[] | {name, description}'

# æ­¥éª¤ 7: æµ‹è¯• MCP è¿æ¥
echo ""
echo "æ­¥éª¤ 7: æµ‹è¯• MCP è¿æ¥..."
SESSION_ID=$(uuidgen)

# å»ºç«‹ SSE è¿æ¥
curl -N -H "Accept: text/event-stream" \
  "${ZKINFO_URL}/sse/virtual-${ENDPOINT_NAME}" \
  -o /tmp/sse-${SESSION_ID}.txt &
SSE_PID=$!

sleep 2

# å‘é€ initialize è¯·æ±‚
echo ""
echo "å‘é€ initialize è¯·æ±‚..."
INIT_RESPONSE=$(curl -s -X POST \
  "${ZKINFO_URL}/mcp/virtual-${ENDPOINT_NAME}/message?sessionId=${SESSION_ID}" \
  -H "Content-Type: application/json" \
  -d '{
    "method": "initialize",
    "params": {
      "protocolVersion": "2024-11-05",
      "capabilities": {},
      "clientInfo": {
        "name": "demo-client",
        "version": "1.0.0"
      }
    },
    "jsonrpc": "2.0",
    "id": 0
  }')

echo "$INIT_RESPONSE" | jq '.'

# å‘é€ tools/list è¯·æ±‚
echo ""
echo "å‘é€ tools/list è¯·æ±‚..."
TOOLS_RESPONSE=$(curl -s -X POST \
  "${ZKINFO_URL}/mcp/virtual-${ENDPOINT_NAME}/message?sessionId=${SESSION_ID}" \
  -H "Content-Type: application/json" \
  -d '{
    "method": "tools/list",
    "params": {},
    "jsonrpc": "2.0",
    "id": 1
  }')

echo "$TOOLS_RESPONSE" | jq '.result.tools | length'

# æ¸…ç†
kill $SSE_PID 2>/dev/null
rm -f /tmp/sse-${SESSION_ID}.txt

echo ""
echo "=========================================="
echo "æ¼”ç¤ºå®Œæˆï¼"
echo "=========================================="
```

### 4.5 æ“ä½œç›®æ ‡æ¸…å•

#### 4.5.1 åŸºç¡€ç¯å¢ƒæ­å»º

- [ ] **ç›®æ ‡ 1.1**: é…ç½® MySQL æ•°æ®åº“
  - åˆ›å»ºæ•°æ®åº“: `mcp_bridge`
  - æ‰§è¡Œåˆå§‹åŒ–è„šæœ¬: `src/main/resources/db/schema.sql`
  - éªŒè¯è¡¨ç»“æ„åˆ›å»ºæˆåŠŸ

- [ ] **ç›®æ ‡ 1.2**: é…ç½® ZooKeeper è¿æ¥
  - ç¡®è®¤ ZooKeeper æœåŠ¡è¿è¡Œ
  - é…ç½®è¿æ¥å­—ç¬¦ä¸²: `zookeeper.connect-string`
  - éªŒè¯è¿æ¥æ­£å¸¸

- [ ] **ç›®æ ‡ 1.3**: é…ç½® Nacos è¿æ¥
  - ç¡®è®¤ Nacos æœåŠ¡è¿è¡Œ
  - é…ç½®æœåŠ¡å™¨åœ°å€: `nacos.server-addr`
  - é…ç½®ç”¨æˆ·åå¯†ç 
  - éªŒè¯è¿æ¥æ­£å¸¸

- [ ] **ç›®æ ‡ 1.4**: é…ç½® Redis è¿æ¥
  - ç¡®è®¤ Redis æœåŠ¡è¿è¡Œ
  - é…ç½®è¿æ¥ä¿¡æ¯
  - éªŒè¯è¿æ¥æ­£å¸¸

#### 4.5.2 æœåŠ¡å¯åŠ¨ä¸æ•°æ®åŠ è½½

- [ ] **ç›®æ ‡ 2.1**: å¯åŠ¨ zkInfo æœåŠ¡
  - æ‰§è¡Œå¯åŠ¨è„šæœ¬
  - éªŒè¯æœåŠ¡å¯åŠ¨æˆåŠŸ
  - æ£€æŸ¥æ—¥å¿—æ— é”™è¯¯

- [ ] **ç›®æ ‡ 2.2**: éªŒè¯ ZooKeeper æ•°æ®åŠ è½½
  - æ£€æŸ¥æ—¥å¿—: "ä» ZooKeeper æ‹‰å–åˆ° X ä¸ª Provider"
  - æŸ¥è¯¢æ•°æ®åº“: `SELECT COUNT(*) FROM zk_dubbo_service`
  - éªŒè¯æ•°æ®å·²æŒä¹…åŒ–

- [ ] **ç›®æ ‡ 2.3**: éªŒè¯ç™½åå•è¿‡æ»¤
  - é…ç½®ç™½åå•: `zk.whitelist.interfaces`
  - éªŒè¯åªæœ‰åŒ¹é…çš„æœåŠ¡è¢«åŠ è½½
  - æ£€æŸ¥æ—¥å¿—: "ç™½åå•è¿‡æ»¤åï¼Œå‰©ä½™ X ä¸ªæœåŠ¡æ¥å£"

- [ ] **ç›®æ ‡ 2.4**: éªŒè¯æœåŠ¡ç›‘å¬å¯åŠ¨
  - æ£€æŸ¥æ—¥å¿—: "å¼€å§‹ç›‘å¬ X ä¸ªå·²å®¡æ‰¹æœåŠ¡æ¥å£"
  - éªŒè¯ç›‘å¬æ­£å¸¸

#### 4.5.3 æœåŠ¡æ³¨å†ŒéªŒè¯

- [ ] **ç›®æ ‡ 3.1**: éªŒè¯ zkInfo èŠ‚ç‚¹æ³¨å†Œ
  - æŸ¥è¯¢ Nacos: æœåŠ¡å `zkinfo`
  - éªŒè¯èŠ‚ç‚¹ IP å’Œç«¯å£æ­£ç¡®
  - éªŒè¯èŠ‚ç‚¹å¥åº·çŠ¶æ€

- [ ] **ç›®æ ‡ 3.2**: éªŒè¯ Dubbo æœåŠ¡æ³¨å†Œä¸º MCP æœåŠ¡
  - æŸ¥è¯¢ Nacos: æœåŠ¡å `zk-mcp-*`
  - éªŒè¯æœåŠ¡å®ä¾‹æ³¨å†Œ
  - éªŒè¯å…ƒæ•°æ®æ­£ç¡®ï¼ˆsseEndpoint, sseMessageEndpointï¼‰

- [ ] **ç›®æ ‡ 3.3**: éªŒè¯å·¥å…·é…ç½®å‘å¸ƒ
  - æŸ¥è¯¢ Nacos é…ç½®ä¸­å¿ƒ: `{serviceName}-tools.json`
  - éªŒè¯å·¥å…·åˆ—è¡¨å®Œæ•´
  - éªŒè¯ inputSchema æ­£ç¡®

#### 4.5.4 è™šæ‹Ÿé¡¹ç›®åˆ›å»º

- [ ] **ç›®æ ‡ 4.1**: åˆ›å»ºè™šæ‹Ÿé¡¹ç›®
  - è°ƒç”¨ API: `POST /api/virtual-projects`
  - éªŒè¯é¡¹ç›®åˆ›å»ºæˆåŠŸ
  - éªŒè¯æ•°æ®åº“æŒä¹…åŒ–

- [ ] **ç›®æ ‡ 4.2**: éªŒè¯è™šæ‹Ÿé¡¹ç›®æ³¨å†Œ
  - æŸ¥è¯¢ Nacos: æœåŠ¡å `virtual-{endpointName}`
  - éªŒè¯æ‰€æœ‰ zkInfo èŠ‚ç‚¹éƒ½æ³¨å†Œ
  - éªŒè¯å·¥å…·èšåˆæ­£ç¡®

- [ ] **ç›®æ ‡ 4.3**: éªŒè¯è™šæ‹Ÿé¡¹ç›®å·¥å…·
  - è°ƒç”¨ API: `GET /api/virtual-projects/{endpointName}/tools`
  - éªŒè¯å·¥å…·åˆ—è¡¨å®Œæ•´
  - éªŒè¯å·¥å…·å®šä¹‰æ­£ç¡®

#### 4.5.5 MCP åè®®éªŒè¯

- [ ] **ç›®æ ‡ 5.1**: å»ºç«‹ SSE è¿æ¥
  - è¯·æ±‚: `GET /sse/virtual-{endpointName}`
  - éªŒè¯è¿”å› `text/event-stream`
  - éªŒè¯æ”¶åˆ° `endpoint` äº‹ä»¶

- [ ] **ç›®æ ‡ 5.2**: åˆå§‹åŒ–è¿æ¥
  - å‘é€ `initialize` è¯·æ±‚
  - éªŒè¯è¿”å›æ­£ç¡®çš„ capabilities
  - éªŒè¯ `listChanged: true` è§¦å‘è‡ªåŠ¨è°ƒç”¨

- [ ] **ç›®æ ‡ 5.3**: è·å–å·¥å…·åˆ—è¡¨
  - å‘é€ `tools/list` è¯·æ±‚
  - éªŒè¯è¿”å›å·¥å…·åˆ—è¡¨
  - éªŒè¯å·¥å…·å®šä¹‰å®Œæ•´ï¼ˆname, description, inputSchemaï¼‰

- [ ] **ç›®æ ‡ 5.4**: è°ƒç”¨å·¥å…·
  - å‘é€ `tools/call` è¯·æ±‚
  - éªŒè¯å‚æ•°è§£ææ­£ç¡®
  - éªŒè¯è°ƒç”¨æˆåŠŸå¹¶è¿”å›ç»“æœ

#### 4.5.6 å‚æ•°è§£æéªŒè¯

- [ ] **ç›®æ ‡ 6.1**: éªŒè¯ç®€å•å‚æ•°è§£æ
  - æ£€æŸ¥å·¥å…· inputSchema
  - éªŒè¯å‚æ•°ç±»å‹æ­£ç¡®
  - éªŒè¯ required å­—æ®µæ­£ç¡®

- [ ] **ç›®æ ‡ 6.2**: éªŒè¯å¤æ‚å¯¹è±¡å‚æ•°è§£æ
  - æ£€æŸ¥åµŒå¥—å¯¹è±¡ properties
  - éªŒè¯é€’å½’è§£ææ­£ç¡®
  - éªŒè¯ additionalProperties: false

- [ ] **ç›®æ ‡ 6.3**: éªŒè¯å‚æ•°æè¿°
  - æ£€æŸ¥å‚æ•° description
  - éªŒè¯æè¿°æ¸…æ™°å‡†ç¡®
  - éªŒè¯ format å­—æ®µæ­£ç¡®ï¼ˆint64, int32 ç­‰ï¼‰

---

## 5. å¿«é€Ÿå¼€å§‹æŒ‡å—

### 5.1 ä¸€é”®å¯åŠ¨è„šæœ¬

åˆ›å»ºæ–‡ä»¶: `scripts/quick-start.sh`

```bash
#!/bin/bash

set -e

echo "=========================================="
echo "zkInfo ä¸€é”®å¯åŠ¨è„šæœ¬"
echo "=========================================="

# 1. æ£€æŸ¥å‰ç½®æ¡ä»¶
echo "1. æ£€æŸ¥å‰ç½®æ¡ä»¶..."
./scripts/check-prerequisites.sh

# 2. åˆå§‹åŒ–æ•°æ®åº“
echo ""
echo "2. åˆå§‹åŒ–æ•°æ®åº“..."
./scripts/init-database.sh

# 3. å¯åŠ¨æœåŠ¡
echo ""
echo "3. å¯åŠ¨ zkInfo æœåŠ¡..."
./scripts/start-zkinfo.sh
```

### 5.2 éªŒè¯è„šæœ¬

åˆ›å»ºæ–‡ä»¶: `scripts/verify-all.sh`

```bash
#!/bin/bash

echo "=========================================="
echo "zkInfo å®Œæ•´éªŒè¯"
echo "=========================================="

# 1. éªŒè¯æœåŠ¡æ³¨å†Œ
./scripts/verify-service-registration.sh

# 2. éªŒè¯è™šæ‹Ÿé¡¹ç›®
./scripts/verify-virtual-project.sh test-endpoint001

# 3. å®Œæ•´æµç¨‹æ¼”ç¤º
./scripts/demo-complete-flow.sh

echo "=========================================="
echo "éªŒè¯å®Œæˆï¼"
echo "=========================================="
```

---

## 6. å¸¸è§é—®é¢˜æ’æŸ¥

### 6.1 æœåŠ¡æœªæ³¨å†Œåˆ° Nacos

**æ£€æŸ¥é¡¹**:
1. Nacos è¿æ¥é…ç½®æ˜¯å¦æ­£ç¡®
2. æœåŠ¡æ˜¯å¦é€šè¿‡å®¡æ‰¹ï¼ˆstatus = APPROVEDï¼‰
3. æ˜¯å¦é€šè¿‡ä¸‰å±‚è¿‡æ»¤æœºåˆ¶
4. æŸ¥çœ‹æ—¥å¿—: `DubboToMcpAutoRegistrationService`

### 6.2 å·¥å…·åˆ—è¡¨ä¸ºç©º

**æ£€æŸ¥é¡¹**:
1. Provider æ˜¯å¦åŒ…å«æ–¹æ³•ä¿¡æ¯
2. æ–¹æ³•å‚æ•°è§£ææ˜¯å¦æˆåŠŸ
3. Nacos é…ç½®ä¸­å¿ƒæ˜¯å¦æœ‰å·¥å…·é…ç½®
4. æŸ¥çœ‹æ—¥å¿—: `NacosMcpRegistrationService.generateMcpTools`

### 6.3 å‚æ•°è§£æå¤±è´¥

**æ£€æŸ¥é¡¹**:
1. ZooKeeper å…ƒæ•°æ®è·¯å¾„æ˜¯å¦å­˜åœ¨
2. æ•°æ®åº“æ˜¯å¦æœ‰æ–¹æ³•å‚æ•°ä¿¡æ¯
3. æ¥å£ç±»æ˜¯å¦å¯è®¿é—®ï¼ˆç”¨äºåå°„ï¼‰
4. æŸ¥çœ‹æ—¥å¿—: `EnhancedMcpToolGenerator`

### 6.4 SSE è¿æ¥å¤±è´¥

**æ£€æŸ¥é¡¹**:
1. ç«¯ç‚¹åç§°æ˜¯å¦æ­£ç¡®
2. è™šæ‹Ÿé¡¹ç›®æ˜¯å¦å·²åˆ›å»º
3. æœåŠ¡æ˜¯å¦å·²æ³¨å†Œåˆ° Nacos
4. æŸ¥çœ‹æ—¥å¿—: `SseController`

---

## 7. é™„å½•

### 7.1 å…³é”®é…ç½®é¡¹

```yaml
# ZooKeeper é…ç½®
zookeeper:
  connect-string: 127.0.0.1:2181
  base-path: /dubbo

# ç™½åå•é…ç½®
zk:
  whitelist:
    interfaces: com.zkinfo.demo.service
    database:
      enabled: true

# Nacos é…ç½®
nacos:
  server-addr: 127.0.0.1:8848
  namespace: public
  registry:
    enabled: true
    service-group: mcp-server

# Redis é…ç½®
mcp:
  session:
    redis:
      type: local
      host: 127.0.0.1
      port: 6379
```

### 7.2 API ç«¯ç‚¹åˆ—è¡¨

- `GET /sse/{endpoint}` - å»ºç«‹ SSE è¿æ¥
- `POST /mcp/{serviceName}/message` - å‘é€ MCP æ¶ˆæ¯
- `POST /api/virtual-projects` - åˆ›å»ºè™šæ‹Ÿé¡¹ç›®
- `GET /api/virtual-projects` - æŸ¥è¯¢è™šæ‹Ÿé¡¹ç›®åˆ—è¡¨
- `GET /api/virtual-projects/{endpointName}/tools` - æŸ¥è¯¢è™šæ‹Ÿé¡¹ç›®å·¥å…·
- `GET /api/dubbo-services` - æŸ¥è¯¢ Dubbo æœåŠ¡åˆ—è¡¨

### 7.3 æ•°æ®åº“è¡¨ç»“æ„

- `zk_project` - é¡¹ç›®è¡¨ï¼ˆå®é™…é¡¹ç›® + è™šæ‹Ÿé¡¹ç›®ï¼‰
- `zk_project_service` - é¡¹ç›®æœåŠ¡å…³è”è¡¨
- `zk_virtual_project_endpoint` - è™šæ‹Ÿé¡¹ç›®ç«¯ç‚¹è¡¨
- `zk_dubbo_service` - Dubbo æœåŠ¡è¡¨
- `zk_dubbo_service_node` - Dubbo æœåŠ¡èŠ‚ç‚¹è¡¨
- `zk_dubbo_method` - Dubbo æ–¹æ³•è¡¨
- `zk_dubbo_method_parameter` - Dubbo æ–¹æ³•å‚æ•°è¡¨

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0.0  
**æœ€åæ›´æ–°**: 2025-01-XX  
**ç»´æŠ¤è€…**: zkInfo Team

