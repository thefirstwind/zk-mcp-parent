<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è™šæ‹Ÿé¡¹ç›®åˆ›å»ºå‘å¯¼</title>
    <style>
        :root {
            --bg: #f6f8fc;
            --card: #ffffff;
            --text: #0f172a;
            --muted: #64748b;
            --border: rgba(15, 23, 42, 0.10);
            --shadow: 0 12px 30px rgba(15, 23, 42, 0.08);
            --shadow-soft: 0 6px 18px rgba(15, 23, 42, 0.06);

            --primary: #4f46e5;
            --primary-2: #7c3aed;
            --primary-hover: #4338ca;
            --success: #16a34a;
            --danger: #dc2626;
            --warning: #f59e0b;
            --info: #0891b2;

            --radius: 16px;
            --radius-sm: 10px;

            --glass: rgba(255, 255, 255, 0.75);
            --glass-border: rgba(255, 255, 255, 0.5);
        }


        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: radial-gradient(900px 400px at 10% 0%, rgba(79, 70, 229, 0.15), transparent 60%),
                radial-gradient(900px 400px at 90% 10%, rgba(124, 58, 237, 0.12), transparent 55%),
                var(--bg);
            color: var(--text);
            line-height: 1.55;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 22px 18px 28px;
        }

        .header {
            position: relative;
            overflow: hidden;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-2) 100%);
            color: white;
            padding: 26px 26px;
            border-radius: var(--radius);
            margin-bottom: 16px;
            box-shadow: var(--shadow);
        }

        .header:before {
            content: "";
            position: absolute;
            inset: -30% -20%;
            background: radial-gradient(circle at 20% 30%, rgba(255, 255, 255, 0.35), transparent 55%),
                radial-gradient(circle at 80% 40%, rgba(255, 255, 255, 0.25), transparent 55%);
            filter: blur(20px);
            opacity: 0.9;
            pointer-events: none;
        }

        .header h1 {
            position: relative;
            font-size: 22px;
            letter-spacing: 0.2px;
        }

        .header-subtitle {
            position: relative;
            margin-top: 6px;
            font-size: 14px;
            opacity: 0.9;
        }

        /* æ­¥éª¤å¯¼èˆª */
        .wizard-steps {
            display: flex;
            justify-content: space-between;
            margin-bottom: 24px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.78);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            backdrop-filter: blur(10px);
            box-shadow: var(--shadow-soft);
        }

        .step {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }

        .step:not(:last-child)::after {
            content: "";
            position: absolute;
            top: 20px;
            left: 60%;
            width: 80%;
            height: 2px;
            background: var(--border);
            z-index: 0;
        }

        .step.completed:not(:last-child)::after {
            background: var(--success);
        }

        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(15, 23, 42, 0.08);
            border: 2px solid var(--border);
            font-weight: 900;
            font-size: 14px;
            color: var(--muted);
            position: relative;
            z-index: 1;
            transition: all 0.3s ease;
        }

        .step.active .step-number {
            background: linear-gradient(135deg, var(--primary), var(--primary-2));
            border-color: var(--primary);
            color: white;
            transform: scale(1.1);
            box-shadow: 0 8px 18px rgba(79, 70, 229, 0.25);
        }

        .step.completed .step-number {
            background: var(--success);
            border-color: var(--success);
            color: white;
        }

        .step.completed .step-number::before {
            content: "âœ“";
        }

        .step-label {
            margin-top: 10px;
            font-size: 13px;
            font-weight: 700;
            color: var(--muted);
            text-align: center;
        }

        .step.active .step-label {
            color: var(--primary);
            font-weight: 900;
        }

        .step.completed .step-label {
            color: var(--success);
        }

        /* å†…å®¹åŒºåŸŸ */
        .wizard-content {
            background: rgba(255, 255, 255, 0.78);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 24px;
            box-shadow: var(--shadow-soft);
            backdrop-filter: blur(10px);
            min-height: 500px;
        }

        .step-panel {
            display: none;
        }

        .step-panel.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .panel-title {
            font-size: 18px;
            font-weight: 900;
            margin-bottom: 16px;
            color: rgba(15, 23, 42, 0.88);
            padding-bottom: 12px;
            border-bottom: 2px solid var(--border);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 800;
            color: rgba(15, 23, 42, 0.72);
            font-size: 14px;
        }

        .form-group .hint {
            font-size: 12px;
            color: var(--muted);
            margin-top: 6px;
            font-weight: 600;
        }

        input[type="text"],
        input[type="url"],
        textarea,
        select {
            width: 100%;
            padding: 10px 14px;
            border: 1px solid var(--border);
            border-radius: 10px;
            font-size: 14px;
            background: rgba(255, 255, 255, 0.92);
            color: var(--text);
            outline: none;
            transition: box-shadow 0.15s ease, border-color 0.15s ease;
            font-family: inherit;
        }

        input:focus,
        textarea:focus,
        select:focus {
            border-color: rgba(79, 70, 229, 0.55);
            box-shadow: 0 0 0 4px rgba(79, 70, 229, 0.15);
        }

        textarea {
            min-height: 120px;
            resize: vertical;
        }

        .btn {
            padding: 10px 16px;
            border: 1px solid transparent;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 700;
            transition: transform 0.16s ease, box-shadow 0.16s ease;
            box-shadow: 0 10px 18px rgba(15, 23, 42, 0.08);
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 14px 22px rgba(15, 23, 42, 0.12);
        }

        .btn:active {
            transform: translateY(0px);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-2));
            color: white;
        }

        .btn-secondary {
            background: rgba(15, 23, 42, 0.08);
            border-color: rgba(15, 23, 42, 0.12);
            color: var(--text);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success), #22c55e);
            color: white;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .wizard-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 0;
            margin-bottom: 24px;
            padding-top: 20px;
            border-top: 1px solid var(--border);
        }

        /* Step 6 Styles */
        .edit-tool-name,
        .edit-tool-desc,
        .edit-tool-schema {
            width: 100%;
            padding: 8px;
            border: 1px solid var(--border);
            border-radius: 4px;
            font-size: 14px;
            margin-top: 4px;
        }

        .selection-item {
            border: 1px solid var(--border);
            border-radius: 8px;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .selection-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        .alert {
            padding: 12px 14px;
            border-radius: 12px;
            margin-bottom: 16px;
            border: 1px solid var(--border);
            font-weight: 700;
            font-size: 14px;
        }

        .alert-info {
            background: rgba(6, 182, 212, 0.10);
            color: #155e75;
        }

        .alert-success {
            background: rgba(34, 197, 94, 0.12);
            color: #166534;
        }

        .alert-error {
            background: rgba(239, 68, 68, 0.10);
            color: #991b1b;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: var(--muted);
            font-weight: 800;
        }

        /* é€‰æ‹©åˆ—è¡¨ */
        .selection-list {
            border: 1px solid var(--border);
            border-radius: 12px;
            max-height: 400px;
            overflow-y: auto;
        }

        .selection-item {
            padding: 12px 16px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: background 0.15s ease;
        }

        .selection-item:hover {
            background: rgba(79, 70, 229, 0.06);
        }

        .selection-item:last-child {
            border-bottom: none;
        }

        .selection-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .selection-item-content {
            flex: 1;
        }

        .selection-item-title {
            font-weight: 800;
            color: var(--text);
            font-size: 14px;
        }

        .selection-item-desc {
            font-size: 12px;
            color: var(--muted);
            margin-top: 4px;
        }

        /* ä»£ç å±•ç¤º */
        .code-block {
            background: rgba(15, 23, 42, 0.95);
            color: #e2e8f0;
            padding: 16px;
            border-radius: 12px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            overflow-x: auto;
            margin: 12px 0;
        }

        /* è¿›åº¦æ¡ */
        .progress-container {
            margin: 20px 0;
            padding: 16px;
            border: 1px solid var(--border);
            border-radius: 12px;
            background: rgba(15, 23, 42, 0.02);
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 14px;
            font-weight: 800;
        }

        .progress-stage {
            color: var(--primary);
        }

        .progress-percentage {
            color: var(--success);
        }

        .progress-bar-track {
            height: 10px;
            background: rgba(15, 23, 42, 0.08);
            border-radius: 999px;
            overflow: hidden;
        }

        .progress-bar-fill {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #4f46e5, #9333ea, #4f46e5);
            background-size: 200% 100%;
            animation: shimmer 2s infinite linear;
            border-radius: 999px;
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 0 15px rgba(79, 70, 229, 0.4);
        }

        @keyframes shimmer {
            0% {
                background-position: 200% 0;
            }

            100% {
                background-position: -200% 0;
            }
        }


        .progress-stats {
            display: flex;
            gap: 20px;
            margin-top: 12px;
            font-size: 13px;
            color: var(--muted);
        }

        .progress-stat {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .progress-stat-label {
            font-weight: 700;
        }

        .progress-stat-value {
            font-weight: 900;
            color: var(--text);
        }

        /* æ—¥å¿—æ§åˆ¶å° */
        .log-console {
            margin-top: 16px;
            padding: 14px;
            border: 1px solid var(--border);
            border-radius: 12px;
            background: rgba(15, 23, 42, 0.95);
            color: #e2e8f0;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }

        .log-entry {
            padding: 4px 0;
            line-height: 1.6;
        }

        .log-entry:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        /* Premium Cards */
        .premium-card {
            background: var(--glass);
            backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border);
            border-radius: var(--radius);
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.07);
            padding: 24px;
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.3s ease;
        }

        .premium-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(31, 38, 135, 0.12);
        }

        /* GAV Pill */
        .gav-container {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: 12px;
        }

        .gav-pill {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .gav-group {
            background: #e0e7ff;
            color: #4338ca;
        }

        .gav-artifact {
            background: #fef3c7;
            color: #92400e;
        }

        .gav-version {
            background: #dcfce7;
            color: #166534;
        }

        /* Status Pulse */
        .status-pulse {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
            position: relative;
        }

        .status-online {
            background: var(--success);
            box-shadow: 0 0 0 0 rgba(22, 163, 74, 1);
            animation: pulse-green 2s infinite;
        }

        .status-offline {
            background: var(--muted);
        }

        @keyframes pulse-green {
            0% {
                transform: scale(0.95);
                box-shadow: 0 0 0 0 rgba(22, 163, 74, 0.7);
            }

            70% {
                transform: scale(1);
                box-shadow: 0 0 0 10px rgba(22, 163, 74, 0);
            }

            100% {
                transform: scale(0.95);
                box-shadow: 0 0 0 0 rgba(22, 163, 74, 0);
            }
        }

        /* Diff Table */
        .diff-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin-top: 16px;
            border: 1px solid var(--border);
            border-radius: 12px;
            overflow: hidden;
        }

        .diff-table th,
        .diff-table td {
            padding: 12px 16px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        .diff-table th {
            background: rgba(15, 23, 42, 0.03);
            font-weight: 800;
            color: var(--muted);
            font-size: 13px;
        }

        .diff-table tr:last-child td {
            border-bottom: none;
        }

        .match-success {
            color: var(--success);
            font-weight: 800;
        }

        .match-fail {
            color: #e11d48;
            font-weight: 800;
            background: rgba(225, 29, 72, 0.05);
            padding: 2px 8px;
            border-radius: 4px;
        }

        .match-success {
            color: #059669;
            font-weight: 800;
            background: rgba(5, 150, 105, 0.05);
            padding: 2px 8px;
            border-radius: 4px;
        }


        /* Badges */
        .badge-premium {
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .badge-online {
            background: rgba(22, 163, 74, 0.15);
            color: #166534;
            border: 1px solid rgba(22, 163, 74, 0.2);
        }

        .badge-offline {
            background: rgba(100, 116, 139, 0.1);
            color: #475569;
            border: 1px solid rgba(100, 116, 139, 0.2);
        }

        @media (max-width: 860px) {
            .wizard-steps {
                flex-wrap: wrap;
            }

            .step:not(:last-child)::after {
                display: none;
            }
        }

        /* Step 4 Methods Card */
        .method-card {
            background: #ffffff;
            border: 1px solid var(--border);
            border-radius: 12px;
            margin-bottom: 12px;
            overflow: hidden;
            transition: all 0.2s ease;
        }

        .method-card:hover {
            border-color: var(--primary);
            box-shadow: var(--shadow-soft);
        }

        .method-header {
            padding: 14px 18px;
            background: #f8fafc;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
        }

        .method-body {
            padding: 0 18px 14px 18px;
        }

        .method-item {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            border-radius: 8px;
            transition: background 0.1s;
        }

        .method-item:hover {
            background: rgba(79, 70, 229, 0.04);
        }

        .method-item input[type="checkbox"] {
            width: 16px;
            height: 16px;
            margin-right: 12px;
        }

        /* Step 2 Analysis Wrapper & Panels */
        .analysis-wrapper {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 24px;
            height: auto;
            min-height: 600px;
            overflow: visible;
        }

        .side-panel {
            height: 300px;
            width: 100%;
            /* Fixed height for panels when stacked */
            background: #ffffff;
            border: 1px solid var(--border);
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            box-shadow: var(--shadow-soft);
        }

        .panel-header {
            padding: 12px 16px;
            background: #f8fafc;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 6px;
            flex-shrink: 0;
        }

        .panel-tag {
            font-size: 11px;
            font-weight: 900;
            color: var(--muted);
            letter-spacing: 1px;
            margin-left: 8px;
            text-transform: uppercase;
        }

        .terminal-body {
            flex: 1;
            background: #0f172a;
            color: #94a3b8;
            padding: 16px;
            font-family: 'JetBrains Mono', 'Consolas', 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.6;
            overflow-y: auto;
            scrollbar-width: thin;
        }

        .terminal-body .log-entry {
            margin-bottom: 4px;
            border-left: 2px solid transparent;
            padding-left: 8px;
        }

        .terminal-body .log-entry:hover {
            background: rgba(255, 255, 255, 0.05);
            border-left-color: var(--primary);
        }

        .interface-stream {
            flex: 1;
            padding: 16px;
            overflow-y: auto;
            background: #fcfdfe;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .dot-red,
        .dot-yellow,
        .dot-green {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        .dot-red {
            background: #ff5f56;
        }

        .dot-yellow {
            background: #ffbd2e;
        }

        .dot-green {
            background: #27c93f;
        }
    </style>



</head>

<body>
    <div class="container">
        <div class="header">
            <h1>è™šæ‹Ÿé¡¹ç›®åˆ›å»ºå‘å¯¼</h1>
            <div class="header-subtitle">æ™ºèƒ½åŒ–åˆ›å»ºå’Œç®¡ç† MCP è™šæ‹Ÿé¡¹ç›®</div>
        </div>

        <!-- æ­¥éª¤å¯¼èˆª -->
        <div class="wizard-steps">
            <div class="step active" data-step="1">
                <div class="step-number">1</div>
                <div class="step-label">POM ä¾èµ–</div>
            </div>
            <div class="step" data-step="2">
                <div class="step-number">2</div>
                <div class="step-label">è§£ææ¥å£</div>
            </div>
            <div class="step" data-step="3">
                <div class="step-number">3</div>
                <div class="step-label">Git ä¿¡æ¯</div>
            </div>
            <div class="step" data-step="4">
                <div class="step-number">4</div>
                <div class="step-label">é€‰æ‹©æ¥å£</div>
            </div>
            <div class="step" data-step="5">
                <div class="step-number">5</div>
                <div class="step-label">å…ƒæ•°æ®è¡¥å…¨</div>
            </div>
            <div class="step" data-step="6">
                <div class="step-number">6</div>
                <div class="step-label">äººå·¥å®¡æ ¸</div>
            </div>
            <div class="step" data-step="7">
                <div class="step-number">7</div>
                <div class="step-label">åˆ›å»ºç»“æœ</div>
            </div>
        </div>

        <!-- å‘å¯¼å†…å®¹ -->
        <div class="wizard-content">
            <!-- æ­¥éª¤ 1: POM ä¾èµ– -->
            <div id="step-1" class="step-panel active">
                <h2 class="panel-title">æ­¥éª¤ 1: é…ç½®é¡¹ç›®ä¿¡æ¯</h2>
                <div class="alert alert-info">
                    è¯·æä¾›é¡¹ç›®çš„åç§°å’Œ POM ä¾èµ–ï¼Œç³»ç»Ÿå°†è‡ªåŠ¨åˆ†æå¹¶æŸ¥æ‰¾ Dubbo æ¥å£å®šä¹‰ã€‚
                </div>

                <div class="form-group">
                    <label>è™šæ‹Ÿé¡¹ç›®åç§° *</label>
                    <input type="text" id="project-name" placeholder="ä¾‹å¦‚: data-analysis-service" required>
                    <div class="hint">é¡¹ç›®çš„å”¯ä¸€æ ‡è¯†ï¼Œç”¨äºç”Ÿæˆ MCP æœåŠ¡åç§°</div>
                </div>

                <div class="form-group">
                    <label>é¡¹ç›®æè¿°</label>
                    <textarea id="project-desc" placeholder="ç®€è¦æè¿°è¿™ä¸ªè™šæ‹Ÿé¡¹ç›®çš„ç”¨é€”..."></textarea>
                </div>

                <div class="form-group">
                    <label>POM ä¾èµ–é…ç½® *</label>
                    <textarea id="pom-content" placeholder="ç²˜è´´ pom.xml æˆ– <dependencies> éƒ¨åˆ†..." rows="10"></textarea>
                    <div class="hint">æ”¯æŒå®Œæ•´çš„ pom.xml æˆ–ä»… dependencies éƒ¨åˆ†</div>
                </div>

                <div id="step1-alert"></div>
            </div>

            <!-- æ­¥éª¤ 2: è§£æè¿›åº¦ -->
            <div id="step-2" class="step-panel">
                <h2 class="panel-title">æ­¥éª¤ 2: ä¾èµ–åˆ†æä¸æ¥å£æå–</h2>
                <div class="alert alert-info">
                    æ­£åœ¨å®æ—¶åŒæ­¥è¿œç¨‹ä»“åº“å¹¶æ‰«æ JAR åŒ…ä¸­çš„æ¥å£å®šä¹‰...
                </div>

                <!-- è¿›åº¦æ˜¾ç¤º -->
                <div id="parse-progress" class="progress-box" style="display: none;">
                    <div class="progress-info">
                        <div class="stage-info">
                            <span class="stage-dot pulse"></span>
                            <span id="progress-stage">åˆå§‹åŒ–å¼•æ“...</span>
                        </div>
                        <span class="stage-percent" id="progress-percentage">0%</span>
                    </div>
                    <div class="progress-track">
                        <div class="progress-fill" id="progress-bar"></div>
                    </div>
                    <div class="progress-grid">
                        <div class="grid-stat">
                            <span class="stat-label">ä¾èµ–æ€»æ•°</span>
                            <span class="stat-value" id="parsed-count">0</span>
                        </div>
                        <div class="grid-stat">
                            <span class="stat-label">å·²ç¼“å­˜</span>
                            <span class="stat-value" id="downloaded-count">0</span>
                        </div>
                        <div class="grid-stat highlight">
                            <span class="stat-label">å‘ç°æ¥å£</span>
                            <span class="stat-value" id="extracted-count">0</span>
                        </div>
                    </div>
                </div>

                <div class="analysis-wrapper">
                    <div class="side-panel logs-panel">
                        <div class="panel-header">
                            <span class="dot-red"></span><span class="dot-yellow"></span><span class="dot-green"></span>
                            <span class="panel-tag">SHELL LOGS</span>
                        </div>
                        <div id="parse-logs" class="terminal-body"></div>
                    </div>
                    <div class="side-panel results-panel">
                        <div class="panel-header">
                            <span class="panel-tag">INTERFACES DISCOVERED</span>
                        </div>
                        <div id="parsed-interfaces-grid" class="interface-stream">
                            <!-- Stream of items -->
                        </div>
                    </div>
                </div>
                <div id="step2-alert"></div>
            </div>

            <!-- æ­¥éª¤ 3: Git ä¿¡æ¯ -->
            <div id="step-3" class="step-panel">
                <h2 class="panel-title">æ­¥éª¤ 3: å…³è”æºç ä»“åº“ (å¯é€‰)</h2>
                <div class="alert alert-info">
                    å…³è” Git ä»“åº“åï¼Œç³»ç»Ÿå°†ä½¿ç”¨ AI è§£ææºç ä»¥è·å–æ›´ç²¾å‡†çš„æ¥å£æ–‡æ¡£ã€‚
                </div>

                <div class="form-group">
                    <label>Git ä»“åº“åœ°å€</label>
                    <input type="url" id="git-url" placeholder="https://github.com/organization/repo.git">
                </div>

                <div class="form-group">
                    <label>åˆ†æ”¯ (Branch)</label>
                    <input type="text" id="git-branch" placeholder="main" value="main">
                </div>
                <div style="clear: both; width: 100%;"></div>
                <div class="form-group">
                    <label>è®¿é—®ä»¤ç‰Œ (AccessToken)</label>
                    <input type="text" id="git-token" placeholder="å¦‚æœæ˜¯ç§æœ‰ä»“åº“è¯·è¾“å…¥ Token">
                </div>

                <button class="btn btn-primary" id="test-git-connection" style="margin-top: 10px;">
                    <span>âš¡ æµ‹è¯•è¿æ¥å¹¶åˆ†ææºç </span>
                </button>
                <div id="step3-alert" style="margin-top: 16px;"></div>
            </div>

            <!-- æ­¥éª¤ 4: æ¥å£é€‰æ‹© -->
            <div id="step-4" class="step-panel">
                <h2 class="panel-title">æ­¥éª¤ 4: æ¥å£ä¸æ–¹æ³•ç²¾é€‰</h2>
                <div class="alert alert-info">
                    è¯·ä»ä»¥ä¸‹è§£æåˆ°çš„æ¥å£ä¸­å‹¾é€‰æ‚¨éœ€è¦æš´éœ²ä¸º MCP Tool çš„æ–¹æ³•ã€‚
                </div>
                <div id="interface-selection" class="selection-grid-modern">
                    <!-- åŠ¨æ€ç”Ÿæˆ -->
                </div>
                <div id="step4-alert" style="margin-top: 16px;"></div>
            </div>

            <!-- æ­¥éª¤ 5: AI å¢å¼º -->
            <div id="step-5" class="step-panel">
                <h2 class="panel-title">æ­¥éª¤ 5: AI å…ƒæ•°æ®æ™ºèƒ½å¢å¼º</h2>
                <div class="alert alert-info">
                    AI æ­£åœ¨åŸºäºæºç è¡¥å…¨æ–¹æ³•æè¿°å’Œå‚æ•°è¯´æ˜ï¼Œç¡®ä¿ MCP å®¢æˆ·ç«¯èƒ½å¤Ÿç†è§£æ¥å£ç”¨é€”ã€‚
                </div>
                <div id="step5-loading" class="loading-premium" style="display: none;">
                    <div class="ai-orbit">
                        <div class="orbit-inner"></div>
                        <div class="orbit-outer"></div>
                    </div>
                    <div class="loading-text">AI ä¸“å®¶æ­£åœ¨åˆ†æé€»è¾‘ä»£ç ä¸­...</div>
                </div>
                <div id="enriched-metadata" class="meta-results-grid">
                    <!-- è¡¥å…¨ç»“æœ -->
                </div>
                <div id="step5-alert"></div>
            </div>

            <!-- æ­¥éª¤ 6: æœ€åå®¡æ ¸ -->
            <div id="step-6" class="step-panel">
                <h2 class="panel-title">æ­¥éª¤ 6: æœ€ç»ˆå®¡æ ¸ä¸å‘å¸ƒé…ç½®</h2>
                <div id="manual-review">
                    <!-- åŠ¨æ€ç”Ÿæˆ -->
                </div>
                <div id="step6-alert"></div>
            </div>

            <!-- æ­¥éª¤ 7: å®Œæˆ -->
            <div id="step-7" class="step-panel">
                <h2 class="panel-title">æ­¥éª¤ 7: åˆ›å»ºæˆåŠŸ</h2>
                <div id="step7-content">
                    <!-- æˆåŠŸä¿¡æ¯ -->
                </div>
                <div id="step7-alert"></div>
            </div>
        </div>

        <!-- å¯¼èˆªæŒ‰é’® -->
        <div class="wizard-actions">
            <button class="btn btn-secondary" id="btn-prev" disabled>ä¸Šä¸€æ­¥</button>
            <button class="btn btn-primary" id="btn-next">ä¸‹ä¸€æ­¥</button>
            <button class="btn btn-success" id="btn-submit" style="display: none;">æäº¤é¡¹ç›®</button>
        </div>

    </div>
    </div>

    <script>
        // å½“å‰æ­¥éª¤
        let currentStep = 1;
        const totalSteps = 7;

        // é¡¹ç›®æ•°æ®
        const projectData = {
            name: '',
            mcpServiceName: '',
            description: '',
            pomContent: '',
            gitUrl: '',
            gitBranch: 'main',
            gitToken: '',
            pomGav: { groupId: '', artifactId: '', version: '' },
            gitMeta: null,
            parsedInterfaces: [],
            selectedInterfaces: [],
            enrichedMetadata: {},
            approvalNotes: ''
        };


        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function () {
            initEventListeners();
            updateStepUI();
        });

        function initEventListeners() {
            // å¯¼èˆªæŒ‰é’®
            document.getElementById('btn-prev').addEventListener('click', previousStep);
            document.getElementById('btn-next').addEventListener('click', nextStep);
            // æ­¥éª¤ç‰¹å®šæŒ‰é’®
            const testGitBtn = document.getElementById('test-git-connection');
            if (testGitBtn) testGitBtn.addEventListener('click', testGitConnection);
        }


        function updateStepUI() {
            // æ›´æ–°æ­¥éª¤æŒ‡ç¤ºå™¨
            document.querySelectorAll('.step').forEach((step, index) => {
                const stepNum = index + 1;
                step.classList.toggle('active', stepNum === currentStep);
                step.classList.toggle('completed', stepNum < currentStep);
            });

            // æ›´æ–°é¢æ¿æ˜¾ç¤º
            document.querySelectorAll('.step-panel').forEach((panel, index) => {
                panel.classList.toggle('active', index + 1 === currentStep);
            });

            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.getElementById('btn-prev').disabled = currentStep === 1;

            // åœ¨ç¬¬ 6 æ­¥ï¼ˆé¢„è§ˆï¼‰å’Œç¬¬ 7 æ­¥ï¼ˆæˆåŠŸï¼‰éšè—åº•éƒ¨é€šç”¨æŒ‰é’®ï¼Œå› ä¸ºå®ƒä»¬æœ‰è‡ªå·±çš„æ“ä½œæŒ‰é’®æˆ–ä¸éœ€è¦æ“ä½œ
            if (currentStep >= 6) {
                document.getElementById('btn-prev').style.display = 'none';
                document.getElementById('btn-next').style.display = 'none';
                document.getElementById('btn-submit').style.display = 'none';
            } else {
                document.getElementById('btn-prev').style.display = 'inline-block';
                document.getElementById('btn-next').style.display = 'inline-block';
                document.getElementById('btn-submit').style.display = 'none';
            }


            // æ­¥éª¤ç‰¹å®šæ¸²æŸ“é€»è¾‘
            if (currentStep === 4) {
                renderStep4();
            } else if (currentStep === 5) {
                // è¿›å…¥æ­¥éª¤5æ—¶ï¼Œå¦‚æœæ²¡æœ‰ç”Ÿæˆè¿‡ï¼Œè‡ªåŠ¨è§¦å‘
                if (!projectData.enrichedMetadata || Object.keys(projectData.enrichedMetadata).length === 0) {
                    processStep5();
                } else {
                    renderStep5Results(projectData.enrichedMetadata);
                }
            } else if (currentStep === 6) {
                renderStep6();
            }
        }

        function previousStep() {
            if (currentStep > 1) {
                currentStep--;
                updateStepUI();
            }
        }

        async function nextStep() {
            // éªŒè¯å½“å‰æ­¥éª¤
            if (!await validateCurrentStep()) {
                return;
            }

            // æ‰§è¡Œæ­¥éª¤ç‰¹å®šé€»è¾‘
            if (currentStep === 1) {
                await processStep1();
            } else if (currentStep === 2) {
                await processStep2();
            } else if (currentStep === 4) {
                await processStep4();
            } else if (currentStep === 5) {
                // Step 5 åªæ˜¯å±•ç¤ºï¼Œæ•°æ®å·²ç»åœ¨ projectData.enrichedMetadata ä¸­
                // ç‚¹å‡»ä¸‹ä¸€æ­¥æ—¶ï¼Œä¸éœ€è¦é¢å¤–å¤„ç†ï¼Œç›´æ¥è¿›å…¥ Step 6
            } else if (currentStep === 6) {
                if (!validateStep6()) return;
            } else if (currentStep === 5) {
                await processStep5();
            }

            if (currentStep < totalSteps) {
                currentStep++;
                updateStepUI();
            }
        }

        async function validateCurrentStep() {
            switch (currentStep) {
                case 1:
                    const name = document.getElementById('project-name').value.trim();
                    const pom = document.getElementById('pom-content').value.trim();
                    if (!name || !pom) {
                        showAlert('step1-alert', 'è¯·å¡«å†™é¡¹ç›®åç§°å’Œ POM ä¾èµ–', 'error');
                        return false;
                    }

                    // Check if project name already exists
                    try {
                        const checkResponse = await fetch('/api/wizard/check-name', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ projectName: name })
                        });

                        if (!checkResponse.ok) {
                            throw new Error('Server returned ' + checkResponse.status);
                        }

                        const checkResult = await checkResponse.json();
                        if (checkResult.exists) {
                            showAlert('step1-alert', checkResult.message, 'error');
                            return false;
                        }
                    } catch (e) {
                        console.error("Name check failed", e);
                        showAlert('step1-alert', 'éªŒè¯é¡¹ç›®åç§°å¤±è´¥: ' + e.message, 'error');
                        return false;
                    }

                    projectData.name = name;
                    projectData.mcpServiceName = 'virtual-' + name.toLowerCase().replace(/[^a-z0-9]/g, '-');

                    projectData.description = document.getElementById('project-desc').value.trim();
                    projectData.pomContent = pom;
                    return true;


                case 3:
                    projectData.gitUrl = document.getElementById('git-url').value.trim();
                    projectData.gitBranch = document.getElementById('git-branch').value.trim() || 'main';
                    projectData.gitToken = document.getElementById('git-token').value.trim();
                    return true;

                case 4:
                    if (projectData.selectedInterfaces.length === 0) {
                        showAlert('step4-alert', 'è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªæ¥å£', 'error');
                        return false;
                    }
                    return true;

                default:
                    return true;
            }
        }

        function renderStep6() {
            const container = document.getElementById('manual-review');
            if (!container) return;
            container.innerHTML = '';

            const tools = projectData.enrichedMetadata && projectData.enrichedMetadata.tools ? projectData.enrichedMetadata.tools : [];

            // Header Section
            const header = document.createElement('div');
            header.className = 'premium-card';
            header.style.marginBottom = '24px';
            header.style.borderLeft = '6px solid var(--primary)';
            header.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                    <div>
                        <h3 style="font-weight: 900; margin-bottom: 8px;">å‘å¸ƒç¡®è®¤ (Review & Launch)</h3>
                        <p style="color: var(--muted); font-size: 14px;">è¯·ç¡®è®¤ä¸ºè™šæ‹Ÿé¡¹ç›® ${projectData.name} ç”Ÿæˆçš„å·¥å…·æ¥å£åˆ—è¡¨ã€‚ç‚¹å‡»å‘å¸ƒåå°†ç›´æ¥åŒæ­¥è‡³ Nacos æœåŠ¡å™¨ã€‚</p>
                    </div>
                    <div class="badge-premium badge-online">å¾…å‘å¸ƒ</div>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
                    <div>
                        <label style="font-size: 12px; font-weight: 800; color: var(--muted);">é¡¹ç›®åç§°</label>
                        <div style="font-weight: 900; font-size: 16px;">${projectData.name}</div>
                    </div>
                    <div>
                        <label style="font-size: 12px; font-weight: 800; color: var(--muted);">MCP æœåŠ¡å</label>
                        <div style="font-weight: 900; font-size: 16px; color: var(--primary);">${projectData.mcpServiceName}</div>
                    </div>
                </div>
            `;
            container.appendChild(header);

            // Tools Section
            const toolsCard = document.createElement('div');
            toolsCard.className = 'premium-card';
            toolsCard.style.marginBottom = '24px';
            toolsCard.innerHTML = `
                <h4 style="font-weight: 800; margin-bottom: 16px;">ç”Ÿæˆçš„å·¥å…· (${tools.length})</h4>
                <div id="final-tools-preview" style="display: flex; flex-direction: column; gap: 12px;"></div>
            `;
            container.appendChild(toolsCard);

            const previewList = toolsCard.querySelector('#final-tools-preview');
            tools.forEach((tool, index) => {
                const item = document.createElement('div');
                item.style.cssText = 'padding: 16px; border: 1px solid var(--border); border-radius: 12px; background: white; transition: all 0.2s; position: relative;';
                item.addEventListener('mouseenter', () => {
                    item.style.borderColor = 'var(--primary)';
                    item.style.boxShadow = 'var(--shadow-soft)';
                    item.style.transform = 'translateY(-2px)';
                });
                item.addEventListener('mouseleave', () => {
                    item.style.borderColor = 'var(--border)';
                    item.style.boxShadow = 'none';
                    item.style.transform = 'translateY(0)';
                });

                item.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span style="width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; background: rgba(79, 70, 229, 0.1); color: var(--primary); border-radius: 6px; font-size: 12px; font-weight: 800;">${index + 1}</span>
                            <span style="font-weight: 900; color: var(--primary); font-size: 15px;">${tool.toolName || tool.name}</span>
                        </div>
                        <span style="font-size: 10px; font-family: monospace; color: var(--muted); background: #f1f5f9; padding: 2px 6px; border-radius: 4px;">${tool.interfaceName || ''}</span>
                    </div>
                    <div style="font-size: 13px; color: var(--text); padding-left: 34px;">${tool.description}</div>
                `;
                previewList.appendChild(item);
            });

            // Action Buttons
            const actions = document.createElement('div');
            actions.style.cssText = 'display: flex; gap: 16px; margin-top: 24px;';
            actions.innerHTML = `
                <button class="btn btn-primary" id="btn-approve" style="flex: 2; padding: 14px; font-weight: 900;">ğŸš€ ç¡®è®¤æ— è¯¯ï¼Œç«‹å³å‘å¸ƒè‡³ Nacos</button>
                <button class="btn btn-secondary" id="btn-disapprove" style="flex: 1; padding: 14px;">ä¸Šä¸€æ­¥ä¿®æ”¹</button>
            `;
            container.appendChild(actions);

            document.getElementById('btn-approve').addEventListener('click', () => {
                submitProject();
            });

            document.getElementById('btn-disapprove').addEventListener('click', () => {
                previousStep();
            });
        }


        function validateStep6() {
            const alertBox = document.getElementById('step6-alert');
            alertBox.innerHTML = '';
            alertBox.className = '';

            // 1. éªŒè¯ JSON Schema æ ¼å¼
            const tools = projectData.enrichedMetadata.tools || [];
            for (let i = 0; i < tools.length; i++) {
                try {
                    JSON.parse(tools[i].inputSchema);
                } catch (e) {
                    alertBox.innerHTML = `Tool #${i + 1} (${tools[i].toolName}) çš„ Input Schema ä¸æ˜¯æœ‰æ•ˆçš„ JSON æ ¼å¼ã€‚`;
                    alertBox.className = 'alert alert-error';
                    return false;
                }

                if (!tools[i].toolName || tools[i].toolName.trim() === '') {
                    alertBox.innerHTML = `Tool #${i + 1} çš„åç§°ä¸èƒ½ä¸ºç©ºã€‚`;
                    alertBox.className = 'alert alert-error';
                    return false;
                }
            }

            return true;
        }

        async function processStep1() {
            // æ­¥éª¤1å®Œæˆåï¼Œè‡ªåŠ¨è§¦å‘æ­¥éª¤2çš„è§£æ
            console.log('æ­¥éª¤1æ•°æ®å·²ä¿å­˜', projectData);

            // è¿›å…¥æ­¥éª¤2æ—¶è‡ªåŠ¨å¼€å§‹è§£æ
            setTimeout(() => {
                if (currentStep === 2) {
                    startPomParsing();
                }
            }, 100);
        }

        async function processStep2() {
            // æ­¥éª¤2ä¸éœ€è¦é¢å¤–å¤„ç†ï¼Œè§£æå·²åœ¨ processStep1 ä¸­è§¦å‘
        }

        /**
         * å¼€å§‹ POM è§£æï¼ˆä½¿ç”¨ SSE æ¥æ”¶è¿›åº¦ï¼‰
         */
        async function startPomParsing() {
            const sessionId = 'session_' + Date.now();

            // æ˜¾ç¤ºè¿›åº¦UI
            document.getElementById('parse-progress').style.display = 'block';
            // document.getElementById('step2-result').style.display = 'block'; // This element doesn't exist in the provided HTML

            // å»ºç«‹ SSE è¿æ¥
            const eventSource = new EventSource(`/api/wizard/parse-pom/progress?sessionId=${sessionId}`);

            eventSource.addEventListener('progress', function (event) {
                const progress = JSON.parse(event.data);
                updateProgress(progress);

                // å¦‚æœå®Œæˆæˆ–å‡ºé”™ï¼Œå…³é—­è¿æ¥
                if (progress.completed || progress.hasError) {
                    eventSource.close();

                    if (progress.hasError) {
                        showAlert('step2-alert', `è§£æå¤±è´¥: ${progress.errorMessage}`, 'error');
                    } else if (progress.result) {
                        displayParseResult(progress.result);
                    }
                }
            });

            eventSource.onerror = function (error) {
                console.error('SSE è¿æ¥é”™è¯¯:', error);
                eventSource.close();
                showAlert('step2-alert', 'SSE è¿æ¥å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•', 'error');
            };

            // å‘èµ·è§£æè¯·æ±‚
            try {
                const response = await fetch('/api/wizard/parse-pom', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        projectName: projectData.name,
                        pomContent: projectData.pomContent,
                        sessionId: sessionId
                    })
                });

                const result = await response.json();
                if (!result.success) {
                    eventSource.close();
                    showAlert('step2-alert', result.message || 'å¯åŠ¨è§£æå¤±è´¥', 'error');
                }
            } catch (error) {
                eventSource.close();
                console.error('å¯åŠ¨è§£æå¤±è´¥:', error);
                showAlert('step2-alert', 'å¯åŠ¨è§£æå¤±è´¥: ' + error.message, 'error');
            }
        }

        /**
         * æ›´æ–°è¿›åº¦æ˜¾ç¤º
         */
        function updateProgress(progress) {
            // æ›´æ–°è¿›åº¦æ¡
            const percentage = progress.progressPercentage || 0;
            document.getElementById('progress-bar').style.width = percentage + '%';
            document.getElementById('progress-percentage').textContent = percentage + '%';
            document.getElementById('progress-stage').textContent = progress.stageDescription || '';

            // æ›´æ–°ç»Ÿè®¡æ•°æ®
            document.getElementById('parsed-count').textContent = progress.parsedDependencies || 0;
            document.getElementById('downloaded-count').textContent = progress.downloadedJars || 0;
            document.getElementById('extracted-count').textContent = progress.extractedInterfaces || 0;

            // è¿½åŠ æ—¥å¿—
            if (progress.logs && progress.logs.length > 0) {
                const logConsole = document.getElementById('parse-logs');
                progress.logs.forEach(log => {
                    const logEntry = document.createElement('div');
                    logEntry.className = 'log-entry';
                    logEntry.textContent = log;
                    logConsole.appendChild(logEntry);
                });

                // æ»šåŠ¨åˆ°åº•éƒ¨
                logConsole.scrollTop = logConsole.scrollHeight;
            }
        }

        /**
         * æ˜¾ç¤ºè§£æç»“æœ
         */
        function displayParseResult(result) {
            if (!result.success) return;

            projectData.parsedInterfaces = result.interfaces || [];

            // Extract GAV if available in result
            if (result.groupId || result.artifactId) {
                projectData.pomGav = {
                    groupId: result.groupId || 'unknown',
                    artifactId: result.artifactId || 'unknown',
                    version: result.version || 'unknown'
                };
            }


            // This element doesn't exist in the provided HTML
            // document.getElementById('interface-count-hero').textContent = result.interfaceCount || 0;
            // document.getElementById('step2-result').style.display = 'block';

            // GAV Pills
            const gavRef = projectData.pomGav;
            // This element doesn't exist in the provided HTML
            // document.getElementById('main-pom-gav').innerHTML = `
            //     <span class="gav-pill gav-group" title="GroupId">${gavRef.groupId || 'unknown'}</span>
            //     <span class="gav-pill gav-artifact" title="ArtifactId">${gavRef.artifactId || 'unknown'}</span>
            //     <span class="gav-pill gav-version" title="Version">${gavRef.version || 'unknown'}</span>
            // `;

            const grid = document.getElementById('parsed-interfaces-grid');
            grid.innerHTML = '';

            projectData.parsedInterfaces.forEach(iface => {
                const card = document.createElement('div');
                card.className = 'premium-card';
                card.style.cssText = 'padding: 12px 16px; background: #fff; border: 1px solid var(--border); border-radius: 8px; transition: all 0.2s;';
                card.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div style="flex: 1;">
                            <div style="font-weight: 800; color: var(--primary); font-size: 14px; word-break: break-all;">
                                ${iface.simpleClassName}
                            </div>
                            <div style="font-size: 11px; color: var(--muted); font-family: monospace; filter: opacity(0.85); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 400px;">
                                ${iface.interfaceName}
                            </div>
                        </div>
                        <div style="text-align: right; min-width: 100px;">
                            <div style="font-size: 11px; color: var(--muted);"><span style="font-family: monospace;">${iface.methods ? iface.methods.length : 0}</span> methods</div>
                            <div style="font-size: 10px; color: #94a3b8; font-family: monospace;">${iface.jarName}</div>
                        </div>
                    </div>
                `;
                grid.appendChild(card);
            });

            // Auto scroll results
            const container = grid.parentElement;
            container.scrollTop = container.scrollHeight;
        }


        /**
         * æ¸²æŸ“æ­¥éª¤4ï¼šæ¥å£é€‰æ‹©
         */
        async function renderStep4() {
            const container = document.getElementById('interface-selection');
            container.innerHTML = `
                <div class="loading">
                    <div class="spinner-border text-primary" role="status"></div>
                    <div style="margin-top: 16px;">æ­£åœ¨é€šè¿‡ ZooKeeper æ£€æŸ¥æœåŠ¡å®ä¾‹çŠ¶æ€...</div>
                </div>`;

            const ifaceNames = projectData.parsedInterfaces.map(i => i.interfaceName);
            if (ifaceNames.length === 0) {
                container.innerHTML = '<div class="alert alert-warning">æœªå‘ç°æ¥å£å®šä¹‰ï¼Œè¯·è¿”å›ä¸Šä¸€æ­¥è§£æ POMã€‚</div>';
                return;
            }

            let providerStatus = {};
            try {
                const response = await fetch('/api/wizard/check-providers', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ interfaces: ifaceNames })
                });
                providerStatus = await response.json();
            } catch (error) {
                console.error('æ£€æŸ¥æœåŠ¡çŠ¶æ€å¤±è´¥:', error);
                container.innerHTML = `<div class="alert alert-error">æ— æ³•è¿æ¥ ZooKeeper æ£€æŸ¥å®ä¾‹çŠ¶æ€ã€‚</div>`;
                return;
            }

            container.innerHTML = '';

            const header = document.createElement('div');
            header.style.cssText = 'display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;';
            header.innerHTML = `
                <div style="font-size: 14px; color: var(--muted); font-weight: 600;">
                    è¯·é€‰æ‹©è¦åœ¨è™šæ‹Ÿé¡¹ç›®ä¸­åŒ…å«çš„æ¥å£ï¼ˆä»…æ˜¾ç¤ºåœ¨çº¿æœåŠ¡ï¼‰ï¼š
                </div>
                <button class="btn btn-sm btn-outline-secondary" onclick="renderStep4()">ğŸ”„ åˆ·æ–°çŠ¶æ€</button>
            `;
            container.appendChild(header);

            // åˆå§‹åŒ–é€‰ä¸­çŠ¶æ€
            if (!projectData.selectedInterfaces || projectData.selectedInterfaces.length === 0) {
                projectData.selectedInterfaces = JSON.parse(JSON.stringify(projectData.parsedInterfaces));
                projectData.selectedInterfaces.forEach(i => {
                    if (i.methods) i.methods.forEach(m => m.selected = false);
                });
            }

            let anyOnline = false;
            projectData.parsedInterfaces.forEach((iface, index) => {
                const status = providerStatus[iface.interfaceName] || { online: false, count: 0 };
                const isOnline = status.online;
                const nodeCount = status.count;
                if (isOnline) anyOnline = true;

                let currentIfaceData = projectData.selectedInterfaces.find(i => i.interfaceName === iface.interfaceName);
                if (!currentIfaceData) {
                    currentIfaceData = {
                        interfaceName: iface.interfaceName,
                        methods: iface.methods.map(m => ({ methodName: m.methodName, selected: false }))
                    };
                    projectData.selectedInterfaces.push(currentIfaceData);
                }

                const card = document.createElement('div');
                card.className = 'method-card';
                if (!isOnline) card.style.opacity = '0.6';

                const allChecked = currentIfaceData.methods.every(m => m.selected);
                const someSelected = currentIfaceData.methods.some(m => m.selected);

                const statusBadge = isOnline ?
                    `<div class="badge-premium badge-online" style="display: flex; align-items: center; gap: 6px; padding: 6px 12px; border-radius: 20px;">
                        <span class="status-pulse status-online"></span>
                        <span>åœ¨çº¿æœåŠ¡ (${nodeCount} èŠ‚ç‚¹)</span>
                     </div>` :
                    `<div class="badge-premium badge-offline" style="padding: 6px 12px; border-radius: 20px;">ç¦»çº¿</div>`;

                card.innerHTML = `
                    <div class="method-header" style="padding: 20px 24px; background: white; border-bottom: 1px solid #f1f5f9; hover: background: #f8fafc;">
                        <div style="display: flex; align-items: center; gap: 16px; flex: 1;" onclick="toggleCard(this)">
                            <div style="font-size: 14px; color: var(--primary); transition: transform 0.3s;" class="collapse-icon">${someSelected ? 'âœ•' : 'ğŸ”'}</div>
                            <div>
                                <div style="font-weight: 900; font-size: 16px; color: var(--text); letter-spacing: -0.3px;">${iface.simpleClassName}</div>
                                <div style="font-size: 11px; color: var(--muted); font-family: monospace; margin-top: 2px;">${iface.interfaceName}</div>
                            </div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 20px;">
                            ${statusBadge}
                            <div style="height: 24px; width: 1px; background: #e2e8f0;"></div>
                            <input type="checkbox" class="iface-master-check"
                                   style="width: 22px; height: 22px; cursor: pointer; accent-color: var(--primary);"
                                   ${isOnline ? '' : 'disabled'}
                                   ${allChecked ? 'checked' : ''}>
                        </div>
                    </div>
                    <div class="method-body" style="display: ${someSelected ? 'block' : 'none'}; padding: 20px 24px 24px 24px; background: #fafbfc;">
                        <div style="margin-bottom: 16px; font-size: 11px; color: var(--muted); font-weight: 800; text-transform: uppercase; letter-spacing: 1px; display: flex; align-items: center; gap: 8px;">
                            <span style="width: 12px; height: 1px; background: #cbd5e1;"></span> æ–¹æ³•åˆ—è¡¨ (Available Methods)
                        </div>
                        <div class="method-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 12px;">
                            ${iface.methods.map(method => {
                    const mData = currentIfaceData.methods.find(m => m.methodName === method.methodName);
                    const isSelected = mData ? mData.selected : false;
                    return `
                                    <label class="method-item" style="cursor: ${isOnline ? 'pointer' : 'default'}; background: white; border: 1px solid #e2e8f0; padding: 12px 16px; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.02);">
                                        <input type="checkbox" class="method-check" data-iface="${iface.interfaceName}" data-method="${method.methodName}"
                                               style="accent-color: var(--primary); width: 18px; height: 18px;"
                                               ${isSelected ? 'checked' : ''} ${isOnline ? '' : 'disabled'}>
                                        <div style="flex: 1; margin-left: 4px;">
                                            <div style="font-weight: 700; font-size: 13.5px; color: var(--text);">${method.methodName}</div>
                                            <div style="font-size: 10.5px; color: #94a3b8; font-family: monospace; margin-top: 2px;">
                                                (${method.parameters.map(p => p.typeSimpleName).join(', ')})
                                            </div>
                                        </div>
                                    </label>
                                `;
                }).join('')}
                        </div>
                    </div>
                `;

                // Master checkbox logic
                const masterCheck = card.querySelector('.iface-master-check');
                masterCheck.indeterminate = someSelected && !allChecked;

                masterCheck.addEventListener('change', (e) => {
                    const checked = e.target.checked;
                    card.querySelectorAll('.method-check').forEach(cb => {
                        cb.checked = checked;
                        updateMethodSelection(cb);
                    });
                    masterCheck.indeterminate = false;
                });

                // Individual method checkbox logic
                card.querySelectorAll('.method-check').forEach(cb => {
                    cb.addEventListener('change', () => {
                        updateMethodSelection(cb);
                        const allCheckboxes = Array.from(card.querySelectorAll('.method-check'));
                        const anyChecked = allCheckboxes.some(c => c.checked);
                        const allMethodsChecked = allCheckboxes.every(c => c.checked);
                        masterCheck.checked = allMethodsChecked;
                        masterCheck.indeterminate = anyChecked && !allMethodsChecked;
                    });
                });

                container.appendChild(card);
            });

            if (!anyOnline) {
                const alertDiv = document.createElement('div');
                alertDiv.className = 'alert alert-error';
                alertDiv.style.marginTop = '20px';
                alertDiv.innerHTML = 'âš ï¸ <strong>æœªå‘ç°ä»»ä½•åœ¨çº¿çš„æœåŠ¡å®ä¾‹ï¼</strong><br>è¯·æ£€æŸ¥ Dubbo Provider æ˜¯å¦å¯åŠ¨å¹¶æ³¨å†Œåˆ°äº† ZooKeeperã€‚';
                container.prepend(alertDiv);
            }
        }

        function toggleCard(headerPart) {
            const card = headerPart.closest('.method-card');
            const body = card.querySelector('.method-body');
            const icon = card.querySelector('.collapse-icon');
            const isHidden = body.style.display === 'none';
            body.style.display = isHidden ? 'block' : 'none';
            icon.textContent = isHidden ? 'âœ•' : 'ğŸ”';
            icon.style.transform = isHidden ? 'rotate(90deg)' : 'rotate(0deg)';
        }


        function updateMethodSelection(checkbox) {
            const ifaceName = checkbox.dataset.iface;
            const methodName = checkbox.dataset.method;
            const checked = checkbox.checked;

            const iface = projectData.selectedInterfaces.find(i => i.interfaceName === ifaceName);
            if (iface) {
                const method = iface.methods.find(m => m.methodName === methodName);
                if (method) method.selected = checked;
            }
        }

        function updateSelectAllState(interfaceName, selectAllCheckbox) {
            const iface = projectData.selectedInterfaces.find(i => i.interfaceName === interfaceName);
            if (iface && iface.methods) {
                const allSelected = iface.methods.every(m => m.selected);
                const someSelected = iface.methods.some(m => m.selected);
                selectAllCheckbox.checked = allSelected;
                selectAllCheckbox.indeterminate = someSelected && !allSelected;
            }
        }

        function toggleMethodSelection(interfaceName, methodName, checked) {
            const iface = projectData.selectedInterfaces.find(i => i.interfaceName === interfaceName);
            if (iface && iface.methods) {
                const method = iface.methods.find(m => m.methodName === methodName);
                if (method) {
                    method.selected = checked;
                }
            }
        }

        function toggleInterfaceSelection(interfaceName, checked) {
            const iface = projectData.selectedInterfaces.find(i => i.interfaceName === interfaceName);
            if (iface && iface.methods) {
                iface.methods.forEach(m => m.selected = checked);
            }
        }

        async function processStep4() {
            // éªŒè¯è‡³å°‘é€‰æ‹©äº†ä¸€ä¸ªæ–¹æ³•
            let count = 0;
            projectData.selectedInterfaces.forEach(i => {
                if (i.methods) count += i.methods.filter(m => m.selected).length;
            });
            console.log(`å…±é€‰æ‹©äº† ${count} ä¸ªæ–¹æ³•`);
            // Step validation handled in validateCurrentStep
        }

        /**
         * æ‰§è¡Œæ­¥éª¤5ï¼šAI å…ƒæ•°æ®è¡¥å…¨
         */
        async function processStep5() {
            const loading = document.getElementById('step5-loading');
            const resultDiv = document.getElementById('enriched-metadata');
            const alertDiv = document.getElementById('step5-alert');

            loading.style.display = 'block';
            resultDiv.innerHTML = '';
            alertDiv.innerHTML = '';

            try {
                // è¿‡æ»¤åªåŒ…å«é€‰ä¸­çš„æ¥å£å’Œæ–¹æ³•
                const filteredInterfaces = projectData.selectedInterfaces
                    .map(iface => {
                        // å¤åˆ¶æ¥å£ä¿¡æ¯
                        const newIface = JSON.parse(JSON.stringify(iface));
                        // è¿‡æ»¤æœªé€‰ä¸­çš„æ–¹æ³•
                        if (newIface.methods) {
                            newIface.methods = newIface.methods.filter(m => m.selected);
                        }
                        return newIface;
                    })
                    .filter(iface => iface.methods && iface.methods.length > 0); // åªä¿ç•™ç”±é€‰ä¸­æ–¹æ³•çš„æ¥å£

                if (filteredInterfaces.length === 0) {
                    throw new Error("è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªæ–¹æ³•è¿›è¡Œåˆ†æ");
                }

                const requestPayload = {
                    projectName: projectData.name,
                    originalDescription: projectData.description,
                    gitMetadata: projectData.gitMetadata,
                    selectedInterfaces: filteredInterfaces
                };

                const response = await fetch('/api/wizard/enrich-metadata', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestPayload)
                });

                if (!response.ok) throw new Error('API request failed');

                const enrichedData = await response.json();
                projectData.enrichedMetadata = enrichedData;

                renderStep5Results(enrichedData);

                // è‡ªåŠ¨å¡«å……æè¿°
                if (enrichedData.suggestedDescription) {
                    showAlert('step5-alert', 'âœ… AI åˆ†æå®Œæˆï¼å·²è‡ªåŠ¨ç”Ÿæˆé¡¹ç›®æè¿°å’Œå·¥å…·å®šä¹‰ã€‚', 'success');
                    // å¦‚æœå½“å‰æè¿°ä¸ºç©ºï¼Œæˆ–è€…ç”¨æˆ·åŒæ„ï¼Œå¯ä»¥æ›´æ–° Step 1 çš„æè¿°
                    // è¿™é‡Œæˆ‘ä»¬åœ¨ Step 5 ç•Œé¢å±•ç¤ºï¼Œåç»­ Step 6 è¿˜å¯ä»¥ç¼–è¾‘
                    projectData.description = enrichedData.suggestedDescription;
                    // TODO: æ›´æ–° UI ä¸Šçš„æè¿°æ˜¾ç¤ºï¼ˆå¦‚æœ Step 5 æœ‰æ˜¾ç¤ºçš„è¯ï¼‰
                }

            } catch (error) {
                console.error('AI è¡¥å…¨å¤±è´¥:', error);
                showAlert('step5-alert', 'AI åˆ†æå¤±è´¥: ' + error.message, 'error');
                resultDiv.innerHTML = '<div class="alert alert-danger">æ— æ³•å®Œæˆ AI åˆ†æï¼Œè¯·å°è¯•é‡è¯•æˆ–è·³è¿‡ã€‚</div>';
            } finally {
                loading.style.display = 'none';
            }
        }

        function renderStep5Results(data) {
            const container = document.getElementById('enriched-metadata');

            let html = `
                <div class="premium-card" style="margin-bottom: 24px; border-left: 6px solid var(--primary);">
                    <div style="font-size: 11px; font-weight: 800; color: var(--muted); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px;">AI å»ºè®®çš„é¡¹ç›®æè¿° (Project Insight)</div>
                    <textarea class="form-control" id="step5-suggested-desc" style="width: 100%; min-height: 100px; padding: 12px; border: 1px solid var(--border); border-radius: 8px; font-size: 14px; background: rgba(255,255,255,0.5);">${data.suggestedDescription || ''}</textarea>
                    <div style="margin-top: 12px; font-size: 12px; color: var(--muted);">æç¤ºï¼šä»¥ä¸Šæè¿°ç”± AI æ ¹æ®æ¥å£å®šä¹‰è‡ªåŠ¨ç”Ÿæˆï¼Œæ‚¨å¯ä»¥åœ¨æ­¤è¿›è¡Œå¾®è°ƒã€‚</div>
                </div>
                
                <h3 style="font-weight: 900; margin-bottom: 16px; display: flex; align-items: center; gap: 10px;">
                    <span style="font-size: 20px;">ğŸ› ï¸</span> ç”Ÿæˆçš„ MCP Tool å®šä¹‰ (${data.tools ? data.tools.length : 0})
                </h3>
            `;

            if (data.tools && data.tools.length > 0) {
                data.tools.forEach((tool, index) => {
                    html += `
                        <div class="premium-card" style="margin-bottom: 16px; padding: 20px; position: relative; overflow: hidden;">
                            <div style="position: absolute; top: -10px; right: -10px; font-size: 40px; opacity: 0.03; font-weight: 900;">${index + 1}</div>
                            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px;">
                                <h5 style="margin: 0; color: var(--primary); font-weight: 900; font-size: 16px;">${tool.toolName}</h5>
                                <div style="font-size: 10px; font-family: monospace; color: var(--muted); background: #f1f5f9; padding: 2px 8px; border-radius: 4px;">${tool.interfaceName || ''}</div>
                            </div>
                            <div style="font-size: 14px; color: var(--text); margin-bottom: 16px; font-weight: 600;">${tool.description}</div>
                            <div style="background: rgba(15, 23, 42, 0.02); border: 1px solid rgba(15, 23, 42, 0.05); border-radius: 12px; padding: 16px; position: relative;">
                                <div style="font-size: 10px; font-weight: 800; color: var(--muted); text-transform: uppercase; margin-bottom: 8px;">INPUT SCHEMA (JSON)</div>
                                <div style="font-family: 'JetBrains Mono', 'Consolas', monospace; font-size: 12px; white-space: pre-wrap; color: var(--primary);">${tool.inputSchema}</div>
                            </div>
                        </div>
                    `;
                });
            } else {
                html += '<div class="alert alert-warning">æœªç”Ÿæˆä»»ä½• Tool å®šä¹‰ï¼Œè¯·æ£€æŸ¥æ˜¯å¦é€‰æ‹©äº†æ–¹æ³•ã€‚</div>';
            }

            html += `<div style="text-align: center; margin-top: 32px;">
                        <button class="btn btn-secondary" onclick="processStep5()" style="padding: 12px 24px;">ğŸ”„ é‡æ–°ç”Ÿæˆ</button>
                     </div>`;

            container.innerHTML = html;

            // ç›‘å¬æè¿°å˜åŒ–åŒæ­¥å› projectData
            document.getElementById('step5-suggested-desc').addEventListener('input', (e) => {
                projectData.description = e.target.value;
            });
        }

        async function submitProject() {
            if (!projectData.enrichedMetadata || !projectData.enrichedMetadata.tools) {
                alert('æ²¡æœ‰å¯æäº¤çš„æ•°æ®ï¼Œè¯·å…ˆå®Œæˆå‰ç½®æ­¥éª¤ã€‚');
                return;
            }

            const payload = {
                projectName: projectData.name,
                mcpServiceName: projectData.mcpServiceName,
                description: projectData.description,
                tools: projectData.enrichedMetadata.tools,
                gitUrl: projectData.gitUrl,
                branch: projectData.gitBranch
            };

            if (projectData.gitMeta && projectData.gitMeta.owner) {
                payload.owner = projectData.gitMeta.owner;
            }

            try {
                const response = await fetch('/api/wizard/submit', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();

                if (response.ok && result.success) {
                    // è¿›å…¥æœ€åä¸€æ­¥ï¼šæ˜¾ç¤ºç»“æœ
                    currentStep = 7;
                    updateStepUI();


                    const container = document.getElementById('step7-content');
                    container.innerHTML = `
                        <div class="premium-card" style="text-align: center; padding: 40px;">
                            <div style="font-size: 64px; margin-bottom: 20px;">âœ…</div>
                            <h2 style="font-weight: 900; color: var(--success); margin-bottom: 16px;">é¡¹ç›®åˆ›å»ºå¹¶æ³¨å†ŒæˆåŠŸï¼</h2>
                            <p style="color: var(--muted); margin-bottom: 24px;">
                                è™šæ‹Ÿé¡¹ç›® <strong>${projectData.name}</strong> å·²æˆåŠŸæ³¨å†Œè‡³ Nacosã€‚<br>
                                MCP æœåŠ¡å: <code style="background: #f1f5f9; padding: 4px 8px; border-radius: 4px; color: var(--primary); font-weight: 800;">${projectData.mcpServiceName}</code>
                            </p>
                            <div class="alert alert-info" style="text-align: left; max-width: 600px; margin: 0 auto; border-left: 4px solid var(--info);">
                                <strong>ğŸš€ æ‚¨çš„ MCP æœåŠ¡å·²å°±ç»ª:</strong><br>
                                <div style="margin-top: 10px; padding: 12px; background: rgba(0,0,0,0.05); border-radius: 8px; font-family: monospace; font-size: 13px;">
                                    <strong>SSE Endpoint:</strong><br>
                                    <code style="color: var(--primary); font-weight: 800; word-break: break-all;">${window.location.origin}/sse/${projectData.mcpServiceName}</code>
                                </div>

                                <ul style="margin-top: 12px; padding-left: 20px; font-size: 13px;">
                                    <li>æ‚¨ç°åœ¨å¯ä»¥åœ¨ MCP Router ä¸­å‘ç°å¹¶æ·»åŠ æ­¤æœåŠ¡ã€‚</li>
                                    <li>é…ç½®æ–‡ä»¶å·²ä¿å­˜è‡³: <code style="font-size: 11px; word-break: break-all;">${result.path}</code></li>
                                </ul>
                            </div>

                            <div style="margin-top: 32px;">
                                <button class="btn btn-primary" onclick="location.reload()">åˆ›å»ºå¦ä¸€ä¸ªé¡¹ç›®</button>
                                <button class="btn btn-secondary" onclick="window.close()">å…³é—­é¡µé¢</button>
                            </div>
                        </div>
                    `;
                } else {
                    alert('æäº¤å¤±è´¥: ' + (result.message || 'æœªçŸ¥é”™è¯¯'));
                }
            } catch (error) {
                console.error('æäº¤è¯·æ±‚å¤±è´¥:', error);
                alert('ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥åç«¯æœåŠ¡ã€‚');
            }
        }

        async function saveDraft() {
            // TODO: ä¿å­˜è‰ç¨¿åˆ°æœ¬åœ°å­˜å‚¨æˆ–åç«¯
            console.log('ä¿å­˜è‰ç¨¿', projectData);
            alert('è‰ç¨¿å·²ä¿å­˜ï¼');
        }

        async function testGitConnection() {
            const url = document.getElementById('git-url').value.trim();
            const branch = document.getElementById('git-branch').value.trim();
            const token = document.getElementById('git-token').value.trim();

            if (!url) {
                showAlert('step3-alert', 'è¯·å…ˆè¾“å…¥ Git ä»“åº“åœ°å€', 'error');
                return;
            }

            const btn = document.getElementById('test-git-connection');
            const originalText = btn.textContent;
            btn.textContent = 'æ­£åœ¨åˆ†æ...';
            btn.disabled = true;

            try {
                showAlert('step3-alert', 'æ­£åœ¨è¿æ¥ Git ä»“åº“å¹¶åˆ†æå…ƒæ•°æ®...', 'info');

                const response = await fetch('/api/wizard/git-meta', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ gitUrl: url, branch: branch, token: token })
                });

                const metadata = await response.json();

                if (metadata.success) {
                    console.log('Git å…ƒæ•°æ®æå–æˆåŠŸ:', metadata);
                    projectData.gitMeta = metadata;

                    // æ„å»º Diff Table
                    const currentGav = projectData.pomGav || {};
                    const gitGav = {
                        groupId: metadata.groupId || '-',
                        artifactId: metadata.artifactId || '-',
                        version: metadata.version || '-'
                    };

                    const compare = (a, b) => (a && b && a === b) ? '<div class="match-success">ä¸€è‡´ âœ“</div>' : '<div class="match-fail">å­˜åœ¨å·®å¼‚ âœ—</div>';

                    let tableHtml = `
                        <div style="margin-top: 20px; border: 1px solid var(--border); border-radius: 12px; overflow: hidden; background: white; box-shadow: var(--shadow-soft);">
                            <div style="padding: 12px 16px; background: #f8fafc; border-bottom: 1px solid var(--border); font-weight: 800; font-size: 13px; color: var(--muted); display: flex; align-items: center; gap: 8px;">
                                <span style="font-size: 16px;">ğŸ“Š</span> Maven GAV æ·±åº¦å¯¹æ¯”
                            </div>
                            <div style="padding: 0;">
                                <table style="width: 100%; border-collapse: collapse; font-size: 13px;">
                                    <thead style="background: rgba(0,0,0,0.02);">
                                        <tr>
                                            <th style="padding: 12px 16px; text-align: left; border-bottom: 1px solid var(--border); color: var(--muted);">å±æ€§</th>
                                            <th style="padding: 12px 16px; text-align: left; border-bottom: 1px solid var(--border);">å½“å‰ (Input)</th>
                                            <th style="padding: 12px 16px; text-align: left; border-bottom: 1px solid var(--border);">Git (Remote)</th>
                                            <th style="padding: 12px 16px; text-align: center; border-bottom: 1px solid var(--border);">çŠ¶æ€</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr style="border-bottom: 1px solid #f1f5f9;">
                                            <td style="padding: 12px 16px; font-weight: 600; color: var(--muted);">Group ID</td>
                                            <td style="padding: 12px 16px; font-family: monospace;">${currentGav.groupId || '-'}</td>
                                            <td style="padding: 12px 16px; font-family: monospace;">${gitGav.groupId}</td>
                                            <td style="padding: 12px 16px; text-align: center;">${compare(currentGav.groupId, gitGav.groupId)}</td>
                                        </tr>
                                        <tr style="border-bottom: 1px solid #f1f5f9;">
                                            <td style="padding: 12px 16px; font-weight: 600; color: var(--muted);">Artifact ID</td>
                                            <td style="padding: 12px 16px; font-family: monospace;">${currentGav.artifactId || '-'}</td>
                                            <td style="padding: 12px 16px; font-family: monospace;">${gitGav.artifactId}</td>
                                            <td style="padding: 12px 16px; text-align: center;">${compare(currentGav.artifactId, gitGav.artifactId)}</td>
                                        </tr>
                                        <tr>
                                            <td style="padding: 12px 16px; font-weight: 600; color: var(--muted);">Version</td>
                                            <td style="padding: 12px 16px; font-family: monospace;">${currentGav.version || '-'}</td>
                                            <td style="padding: 12px 16px; font-family: monospace;">${gitGav.version}</td>
                                            <td style="padding: 12px 16px; text-align: center;">${compare(currentGav.version, gitGav.version)}</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div style="margin-top: 16px; padding: 12px 16px; background: rgba(79, 70, 229, 0.05); border-radius: 10px; border: 1px solid rgba(79, 70, 229, 0.1); display: flex; align-items: center; justify-content: space-between;">
                            <div style="font-size: 13px;">
                                <span style="color: var(--muted);">åº”ç”¨åç§°:</span> <strong style="color: var(--primary);">${metadata.applicationName || 'N/A'}</strong>
                                <span style="margin: 0 12px; color: #cbd5e1;">|</span>
                                <span style="color: var(--muted);">è´Ÿè´£äºº:</span> <strong>${metadata.owner || 'N/A'}</strong>
                            </div>
                            <div style="font-size: 11px; padding: 2px 8px; background: var(--primary); color: white; border-radius: 4px; font-weight: 800;">GIT éªŒè¯é€šè¿‡</div>
                        </div>
                    `;


                    showAlert('step3-alert', `âœ… <strong>Git åˆ†ææˆåŠŸï¼</strong>` + tableHtml, 'success', true);


                    // è‡ªåŠ¨å¡«å……ç¼ºå¤±ä¿¡æ¯
                    if (metadata.applicationName && !projectData.name) {
                        projectData.name = metadata.applicationName;
                        document.getElementById('project-name').value = metadata.applicationName;
                    }
                    if (metadata.description && !projectData.description) {
                        projectData.description = metadata.description;
                        document.getElementById('project-desc').value = metadata.description;
                    }
                } else {

                    console.error('Git åˆ†æå¤±è´¥:', metadata.errorMessage);
                    showAlert('step3-alert', `âš ï¸ Git åˆ†ææœªå®Œæˆ: ${metadata.errorMessage}`, 'warning');
                }

            } catch (error) {
                console.error('API è°ƒç”¨å¤±è´¥:', error);
                showAlert('step3-alert', 'ç½‘ç»œè¯·æ±‚å¤±è´¥: ' + error.message, 'error');
            } finally {
                btn.textContent = originalText;
                btn.disabled = false;
            }
        }

        function showAlert(containerId, message, type = 'info', persist = false) {
            const container = document.getElementById(containerId);
            container.innerHTML = `<div class="alert alert-${type}">${message}</div>`;
            if (!persist) {
                setTimeout(() => {
                    if (container.innerHTML.includes(`alert-${type}`)) {
                        container.innerHTML = '';
                    }
                }, 5000);
            }
        }

    </script>
</body>

</html>