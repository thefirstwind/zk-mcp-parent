# 测试检查清单

**创建日期**: 2025-12-15  
**用途**: 逐步验证功能完整性

---

## ✅ 基础功能测试

### 1. 服务启动
- [ ] zkInfo服务启动成功
- [ ] demo-provider服务启动成功
- [ ] mcp-router-v3服务启动成功（可选）
- [ ] 所有服务无启动错误

**验证命令**:
```bash
# 检查服务状态
curl http://localhost:9091/actuator/health
curl http://localhost:8083/actuator/health  # demo-provider可能没有此端点
curl http://localhost:8052/actuator/health  # mcp-router-v3
```

### 2. API端点
- [ ] `/actuator/health` - 健康检查
- [ ] `/api/stats` - 统计信息
- [ ] `/api/providers` - Provider列表
- [ ] `/api/registered-services` - 已注册服务
- [ ] `/api/applications` - 应用列表
- [ ] `/api/interfaces` - 接口列表
- [ ] `/v3/api-docs` - API文档
- [ ] `/swagger-ui.html` - Swagger UI

**验证命令**:
```bash
bash quick-test.sh
```

---

## ✅ 三层过滤机制测试

### 1. 项目级过滤
- [ ] 创建项目成功
- [ ] 关联服务到项目成功
- [ ] 只有项目包含的服务被采集
- [ ] 未关联的服务被过滤

**测试步骤**:
1. 创建项目
2. 关联服务
3. 启动Provider
4. 验证只有关联的服务被采集

### 2. 服务级过滤
- [ ] 添加过滤规则成功
- [ ] 排除规则生效
- [ ] 包含规则生效
- [ ] 优先级排序正确

**测试步骤**:
1. 添加排除规则
2. 验证服务被过滤
3. 添加包含规则
4. 验证服务被包含

### 3. 审批级过滤
- [ ] 提交审批申请成功
- [ ] 审批通过后服务被采集
- [ ] 未审批的服务被过滤
- [ ] 审批状态正确

**测试步骤**:
1. 提交审批申请
2. 验证服务未被采集
3. 审批通过
4. 验证服务被采集

---

## ✅ 项目管理功能测试

### 1. 项目CRUD
- [ ] 创建项目
- [ ] 查询项目列表
- [ ] 查询项目详情
- [ ] 更新项目
- [ ] 删除项目

### 2. 项目服务关联
- [ ] 添加服务到项目
- [ ] 查询项目服务列表
- [ ] 更新服务关联
- [ ] 删除服务关联

### 3. 服务查询
- [ ] 查询服务所属项目
- [ ] 查询项目包含的服务
- [ ] 服务反向索引正确

---

## ✅ 虚拟项目功能测试

### 1. 虚拟项目创建
- [ ] 创建虚拟项目成功
- [ ] Endpoint映射创建成功
- [ ] 服务关联成功
- [ ] 自动注册到Nacos（如果启用）

### 2. 服务编排
- [ ] 从不同项目选择服务
- [ ] 服务优先级设置
- [ ] 服务列表更新
- [ ] 工具列表聚合正确

### 3. 虚拟项目更新
- [ ] 更新服务列表
- [ ] Nacos注册更新
- [ ] Endpoint映射更新

### 4. 虚拟项目删除
- [ ] 删除虚拟项目
- [ ] Nacos注册注销
- [ ] 服务关联清理

---

## ✅ ZooKeeper监听优化测试

### 1. 监听优化效果
- [ ] 只监听项目包含的服务
- [ ] 其他服务被跳过
- [ ] 监听数量大幅减少（90%+）

**验证方法**:
```bash
# 查看日志
tail -f logs/zkinfo.log | grep -E "(发现新服务|跳过监听)"
```

### 2. 实时监听
- [ ] 新服务被立即发现
- [ ] 服务变化被实时监听
- [ ] 过滤规则实时生效

### 3. 性能验证
- [ ] 监听数量减少
- [ ] 内存使用降低
- [ ] CPU使用降低

---

## ✅ Nacos注册功能测试

### 1. 服务注册
- [ ] 服务注册到Nacos成功
- [ ] 配置发布成功（tools, versions, server）
- [ ] 服务实例注册成功
- [ ] 元数据正确

**验证方法**:
1. 检查API响应
2. 检查Nacos控制台
3. 检查日志

### 2. 虚拟项目注册
- [ ] 虚拟项目注册为独立MCP服务
- [ ] 服务名称正确（mcp-{endpointName}）
- [ ] 工具列表聚合正确
- [ ] Endpoint路径正确

### 3. 服务更新
- [ ] 服务变化时自动更新
- [ ] 配置同步更新
- [ ] 实例信息更新

### 4. 服务注销
- [ ] 服务删除时自动注销
- [ ] 配置清理
- [ ] 实例注销

---

## ✅ 集成测试

### 1. 端到端流程
- [ ] 创建项目 → 关联服务 → 审批 → 采集 → 注册
- [ ] 创建虚拟项目 → 编排服务 → 注册到Nacos
- [ ] mcp-router-v3可以路由到虚拟项目

### 2. mcp-router-v3集成
- [ ] mcp-router-v3可以发现zkInfo注册的服务
- [ ] SSE连接正常
- [ ] 消息路由正常
- [ ] 工具调用正常

---

## ✅ 性能测试

### 1. 监听性能
- [ ] 大量服务场景下性能正常
- [ ] 监听数量减少90%+
- [ ] 响应时间正常

### 2. 过滤性能
- [ ] 大量过滤规则下性能正常
- [ ] 过滤响应时间正常
- [ ] 内存使用正常

### 3. 注册性能
- [ ] 批量注册性能正常
- [ ] 注册响应时间正常
- [ ] Nacos压力正常

---

## 📝 测试记录

### 测试环境
- 日期: ___________
- 测试人员: ___________
- Java版本: ___________
- Maven版本: ___________

### 测试结果
- 通过项: ___ / ___
- 失败项: ___ / ___
- 阻塞问题: ___________

### 问题记录
1. ___________
2. ___________
3. ___________

---

**使用说明**:
1. 按照清单逐项测试
2. 每完成一项，勾选对应的复选框
3. 记录测试结果和问题
4. 参考 `TEST_GUIDE.md` 获取详细测试步骤

